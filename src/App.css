@import "tailwindcss";
@custom-variant dark (&:where(.dark, .dark *));

/* ── Theme: fonts only (colors use Tailwind built-in palette) ─────── */
@theme {
  --font-sans: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
}

/* ── Base ──────────────────────────────────────────────────────────── */
@layer base {
  body {
    @apply font-sans text-slate-900 dark:text-slate-100 bg-gray-50 dark:bg-slate-900;
    -webkit-font-smoothing: antialiased;
    transition: background 0.2s ease, color 0.2s ease;
  }
  sup {
    top: 0;
  }
}

/* ── @apply component classes for HTML template strings ───────────── */
@layer components {
  /* Page header (RoadmapPage) */
  .page-header { @apply mb-7; }
  .page-header h1 { @apply text-3xl font-bold tracking-tight mb-1; }
  .page-header .subtitle { @apply text-gray-500 dark:text-slate-400 text-sm mb-1; }
  .page-header .hint { @apply text-gray-400 dark:text-slate-500 text-sm mb-0; }

  /* Section title */
  .section-title { @apply text-2xl font-bold mb-5 tracking-tight; }

  /* Section intro paragraph */
  .section-intro {
    @apply text-sm text-slate-800 dark:text-slate-300 leading-7 mb-6;
  }
  .section-intro strong { @apply text-slate-900 dark:text-slate-100 font-semibold; }
  .section-intro ul { @apply my-2.5 pl-5 list-none; }
  .section-intro ul li { @apply relative py-0.5 pl-2; }
  .section-intro ul li::before {
    content: '\2192';
    @apply absolute -left-4 text-blue-500 dark:text-blue-400 font-semibold;
  }

  /* Section subheading */
  .section-subheading {
    @apply text-lg font-bold text-slate-900 dark:text-slate-100 mt-5 mb-2;
  }
  .section-subheading:first-child { @apply mt-0; }

  /* Table of contents */
  .section-toc {
    @apply mb-6 py-3.5 px-4.5 bg-slate-50 dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700;
  }
  .section-toc-title {
    @apply text-xs font-bold uppercase tracking-wider text-gray-500 dark:text-slate-400 mb-2;
  }
  .toc-link {
    @apply block text-sm text-blue-500 dark:text-blue-400 no-underline py-0.5 cursor-pointer transition-colors duration-150;
  }
  .toc-link:hover { @apply text-slate-900 dark:text-slate-100; }

  [id^="toc-"] { scroll-margin-top: 68px; }

  /* Columns layout */
  .columns { @apply flex gap-6 flex-wrap; }
  .col { @apply flex-1 basis-75 rounded-none p-0 border-none bg-transparent; }
  .col-label {
    @apply text-lg font-bold text-slate-900 dark:text-slate-100 mb-3 pb-2 border-b-2 border-slate-200 dark:border-slate-700;
  }
  .col--webapp .col-label { @apply border-b-blue-500 dark:border-b-blue-400; }
  .col--pkg .col-label { @apply border-b-blue-600 dark:border-b-blue-300; }
  .col--monolith .col-label { @apply border-b-orange-700 dark:border-b-orange-500; }
  .col--monorepo .col-label { @apply border-b-emerald-700 dark:border-b-emerald-500; }

  .section-list { @apply mb-5; }
  .col-item {
    @apply text-sm leading-relaxed py-2 pl-4 relative text-slate-800 dark:text-slate-300;
  }
  .col-item::before {
    content: '\2022';
    @apply absolute left-0 text-gray-500 dark:text-slate-400 font-bold text-sm;
  }

  /* Explainer */
  .explainer { @apply mt-5; }
  .explainer-heading { @apply text-lg font-bold text-slate-900 dark:text-slate-100 mt-0 mb-2; }
  .explainer-body { @apply text-sm leading-7 text-slate-800 dark:text-slate-300; }

  /* Gotcha */
  .gotcha { @apply mt-0 text-sm leading-relaxed text-slate-800 dark:text-slate-300; }

  /* Code Block */
  .code-block {
    @apply mt-4 bg-slate-800 dark:bg-gray-950 text-slate-200 rounded-xl p-5 font-mono text-xs leading-7 overflow-x-auto whitespace-pre-wrap break-words;
  }
  .code-block .comment { @apply text-slate-500; }
  .code-block .key { @apply text-sky-300; }
  .code-block .string { @apply text-green-300; }

  /* Roadmap / Steps */
  .roadmap-intro { @apply text-sm text-slate-800 dark:text-slate-300 leading-relaxed mb-6; }
  .step-card {
    @apply flex gap-4 py-4.5 border-b border-slate-200 dark:border-slate-700 relative;
  }
  .step-card:last-child { @apply border-b-0; }
  .step-number {
    @apply w-9 h-9 rounded-full bg-blue-500 dark:bg-blue-400 text-white dark:text-slate-900 flex items-center justify-center text-sm font-bold shrink-0 relative;
  }
  .step-card:not(:last-child) .step-number::after {
    content: '';
    @apply absolute left-1/2 -translate-x-1/2 w-0.5 bg-blue-100 dark:bg-blue-500/20;
    top: 38px;
    height: calc(100% + 4px);
  }
  .step-content { @apply flex-1 min-w-0; }
  .step-title { @apply text-base font-bold text-slate-900 dark:text-slate-100 mb-1; }
  .step-desc { @apply text-sm text-slate-800 dark:text-slate-300 leading-relaxed mb-2; }
  .step-detail {
    @apply text-xs text-gray-400 dark:text-slate-400 leading-relaxed bg-slate-50 dark:bg-slate-800 rounded-lg py-2.5 px-3.5 mb-2 border border-slate-100 dark:border-slate-700;
  }
  .step-detail code {
    @apply font-mono text-xs bg-slate-200 dark:bg-slate-700 px-1.5 py-px rounded-sm text-slate-900 dark:text-slate-100;
  }
  .step-jump {
    @apply inline-flex items-center gap-1.5 text-sm font-bold text-white cursor-pointer bg-blue-500 dark:bg-blue-400 dark:text-slate-900 border-none font-sans py-2 px-3.5 rounded-lg transition-all duration-150 mt-1 shadow-md shadow-blue-500/25;
  }
  .step-jump:hover {
    @apply bg-blue-600 dark:bg-blue-500 -translate-y-px shadow-lg shadow-blue-500/30;
  }

  .bonus-step {
    @apply mt-7 pt-6 border-b-0 border-t-2 border-dashed border-slate-300 dark:border-slate-600;
  }
  .bonus-number {
    background: linear-gradient(135deg, #f59e0b, #d97706) !important;
    font-size: 15px !important;
  }
  .bonus-step .step-number::after { display: none !important; }

  .bonus-subpage { @apply mt-4.5 py-2 pl-3.5 border-l-2 border-slate-200 dark:border-slate-700; }
  .bonus-subpage-title { @apply text-sm font-bold text-slate-900 dark:text-slate-100 m-0 mb-0.5; }
  .bonus-subpage-desc { @apply text-sm text-slate-800 dark:text-slate-300 leading-normal mb-1; }

  .step-substep { @apply mt-4 pl-3.5 border-l-2 border-slate-200 dark:border-slate-700; }
  .step-substep-title { @apply text-sm font-bold text-slate-900 dark:text-slate-100 m-0 mb-0.5; }
  .step-substep-text { @apply text-sm text-slate-800 dark:text-slate-300 leading-relaxed; }

  .bonus-links { @apply flex flex-wrap gap-2 mt-3; }
  .bonus-links .step-jump { @apply text-xs py-1.5 px-3; }

  /* Accordion */
  .accordion {
    @apply mt-4 border border-slate-200 dark:border-slate-700 rounded-xl overflow-hidden;
  }
  .accordion-toggle {
    @apply w-full py-3.5 px-4.5 bg-slate-50 dark:bg-slate-800 border-none cursor-pointer flex items-center justify-between font-sans text-sm font-semibold text-slate-900 dark:text-slate-100 transition-colors duration-150;
  }
  .accordion-toggle:hover { @apply bg-slate-100 dark:bg-slate-700; }
  .accordion-arrow {
    @apply text-xs inline-block transition-transform duration-200;
  }
  .accordion-arrow.open { @apply rotate-180; }
  .accordion-body {
    @apply max-h-0 overflow-hidden px-4.5;
    transition: max-height 0.3s ease, padding 0.3s ease;
    padding-top: 0;
    padding-bottom: 0;
  }
  .accordion-body.open {
    max-height: 2000px;
    padding-bottom: 16px;
  }

  /* CI Pipeline */
  .ci-step {
    @apply mb-6 pb-6 border-b border-slate-200 dark:border-slate-700;
  }
  .ci-step:last-child { @apply border-b-0 mb-0 pb-0; }
  .ci-step-heading { @apply text-xl font-bold mt-0 mb-2 text-slate-900 dark:text-slate-100; }
  .ci-step-text { @apply text-sm leading-7 text-slate-800 dark:text-slate-300 mb-3; }
  .yaml-heading {
    @apply text-xs font-bold uppercase tracking-wide text-gray-500 dark:text-slate-400 mb-1.5 mt-4;
  }
  .ci-yaml {
    @apply font-mono text-xs leading-relaxed bg-slate-800 dark:bg-gray-950 text-slate-200 py-3 px-4 rounded-lg mb-2.5 whitespace-pre-wrap overflow-x-auto;
  }
  .ci-tip {
    @apply text-sm text-blue-500 dark:text-blue-400 bg-blue-100 dark:bg-blue-500/20 py-2.5 px-3.5 rounded-lg leading-relaxed;
  }
  .ci-tip::before { content: '\1F4A1\0020'; }
  .section-note {
    @apply text-sm text-blue-500 dark:text-blue-400 bg-blue-100 dark:bg-blue-500/20 py-2.5 px-3.5 rounded-lg leading-relaxed my-4;
  }

  .ci-overview-cards { @apply flex flex-col gap-4 mb-6; }
  .ci-overview-card {
    @apply flex gap-3.5 p-4 border border-slate-200 dark:border-slate-700 rounded-xl bg-slate-50 dark:bg-slate-800;
  }
  .ci-overview-num {
    @apply w-7 h-7 rounded-full bg-blue-500 dark:bg-blue-400 text-white dark:text-slate-900 flex items-center justify-center text-sm font-bold shrink-0;
  }
  .ci-overview-card-body { @apply flex-1 min-w-0; }
  .ci-overview-card-title { @apply text-base font-bold text-slate-900 dark:text-slate-100 mb-2; }
  .ci-full-example { @apply mt-7; }
  .ci-full-example-label { @apply text-base font-bold text-slate-900 dark:text-slate-100 mb-2.5; }

  .good-tests-list { @apply list-disc pl-5 m-0; }
  .good-tests-list li { @apply mb-2 leading-relaxed; }
  .good-tests-list li:last-child { @apply mb-0; }

  /* AI Prompt cards */
  .ai-prompt-card { @apply mb-3.5 border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden; }
  .ai-prompt-header {
    @apply flex justify-between items-center py-2 px-3.5 bg-slate-50 dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700;
  }
  .ai-prompt-label { @apply font-bold text-sm text-slate-900 dark:text-slate-100; }
  .ai-prompt-copy {
    @apply font-sans text-xs font-semibold py-1 px-2.5 border border-slate-200 dark:border-slate-700 rounded-md bg-white dark:bg-slate-800 text-gray-500 dark:text-slate-400 cursor-pointer transition-all duration-150 shrink-0;
  }
  .ai-prompt-copy:hover { @apply border-blue-500 dark:border-blue-400 text-blue-500 dark:text-blue-400; }
  .ai-prompt-copy.copied { @apply border-green-500 text-green-500 bg-green-50 dark:bg-green-500/10; }
  .ai-prompt-body {
    @apply font-mono text-xs py-2.5 px-3.5 leading-relaxed text-gray-500 dark:text-slate-400 whitespace-pre-wrap;
  }

  /* Links / Footnotes */
  .links-section { @apply mt-6 border-t border-slate-200 dark:border-slate-700 pt-4; }
  .links-heading { @apply text-lg font-bold text-slate-900 dark:text-slate-100 mb-2.5; }
  .links-list { @apply flex flex-col gap-0; counter-reset: footnote; }
  .footnote-item {
    @apply flex items-baseline gap-2 py-1.5 border-b border-slate-100 dark:border-slate-800 text-sm leading-normal;
  }
  .footnote-item:last-child { @apply border-b-0; }
  .footnote-num { @apply text-xs font-bold text-blue-500 dark:text-blue-400 min-w-4.5 shrink-0; }
  .footnote-link { @apply text-blue-500 dark:text-blue-400 no-underline font-medium; }
  .footnote-link:hover { @apply underline; }
  .footnote-source {
    @apply text-xs font-semibold text-slate-600 dark:text-slate-400 bg-slate-100 dark:bg-slate-700 px-1.5 py-px rounded uppercase tracking-wide ml-1;
  }
  .footnote-note { @apply text-gray-500 dark:text-slate-400 text-xs ml-1; }

  sup.fn-ref {
    @apply text-xs font-bold text-white bg-blue-500 dark:bg-blue-400 dark:text-slate-900 rounded px-1 ml-0.5 cursor-pointer no-underline align-super leading-none;
    transition: background 0.15s;
  }
  sup.fn-ref:hover { @apply bg-blue-700 dark:bg-blue-500; }

  /* Footnote tooltip */
  .fn-tooltip {
    @apply absolute z-50 max-w-72 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg shadow-lg px-3.5 py-2.5 text-sm leading-normal;
    animation: fadeIn 0.12s ease-out;
  }
  .fn-tooltip-link {
    @apply text-blue-500 dark:text-blue-400 font-semibold no-underline inline-flex items-center gap-1;
  }
  .fn-tooltip-link:hover { @apply underline; }
  .fn-tooltip-ext { @apply w-3 h-3 shrink-0 opacity-60; }
  .fn-tooltip-source {
    @apply text-xs font-semibold text-slate-600 dark:text-slate-400 bg-slate-100 dark:bg-slate-700 px-1.5 py-px rounded uppercase tracking-wide ml-1.5;
  }
  .fn-tooltip-note {
    @apply text-xs text-slate-600 dark:text-slate-400 leading-relaxed mt-1.5 mb-0;
  }

  .further-reading-item {
    @apply flex items-baseline gap-1.5 py-1 text-sm leading-normal;
  }
  .further-reading-link {
    @apply text-blue-500 dark:text-blue-400 no-underline font-medium inline-flex items-center gap-1 transition-colors duration-150;
  }
  .further-reading-link:hover { @apply underline; }
  .external-link-icon { @apply w-3 h-3 shrink-0 opacity-60; }
  .further-reading-item .link-source {
    @apply text-xs font-semibold text-slate-600 dark:text-slate-400 bg-slate-100 dark:bg-slate-700 px-1.5 py-px rounded uppercase tracking-wide;
  }

  /* Inline navigation (queried by JS in HtmlContent.tsx) */
  .inline-nav-link {
    @apply font-sans text-[inherit] font-semibold text-blue-500 dark:text-blue-400 bg-transparent border-none p-0 cursor-pointer underline decoration-dotted underline-offset-2;
  }
  .inline-nav-link:hover { text-decoration-style: solid; }

  .inline-nav-pill {
    @apply inline-flex items-center font-sans text-sm font-medium text-blue-500 dark:text-blue-400 bg-blue-100 dark:bg-blue-500/20 py-2 px-3.5 rounded-lg cursor-pointer transition-all duration-150 leading-snug text-left border border-blue-500/20;
  }
  .inline-nav-pill:hover {
    @apply border-blue-500 dark:border-blue-400 shadow-md shadow-blue-500/10 -translate-y-px;
  }

  /* PM toggle commands */
  .cmd {
    @apply font-mono text-xs bg-slate-200 dark:bg-slate-700 px-1.5 rounded text-slate-900 dark:text-slate-100;
  }
  .cmd-pnpm { display: none; }
  .cmd-npm { display: inline; }

  /* Resources section (in section pages) */
  .resources-section { @apply mt-10 pt-8 border-t-2 border-slate-200 dark:border-slate-700; }
  .resources-title { @apply text-lg font-bold mb-1.5 tracking-tight; }
  .resources-subtitle { @apply text-sm text-gray-500 dark:text-slate-400 mb-5 leading-normal; }
  .resources-category {
    @apply text-sm font-bold uppercase tracking-wider text-gray-500 dark:text-slate-400 py-2.5 border-b border-slate-200 dark:border-slate-700 mt-5 mb-0;
  }
  .resources-category:first-of-type { @apply mt-0; }
  .resource-row {
    @apply flex items-center gap-3 py-3 border-b border-slate-100 dark:border-slate-800 text-sm flex-wrap;
  }
  .resource-row:last-child { @apply border-b-0; }

  /* Glossary term inline annotation (used in enriched HTML strings) */
  .glossary-term {
    @apply border-b border-dashed border-current cursor-help transition-[border-bottom-style] duration-150;
  }
  .glossary-term:hover { border-bottom-style: solid; }
}

/* ── Badge variants (data-driven class names) ─────────────────────── */
@layer components {
  .resource-badge {
    @apply text-xs font-semibold px-2 py-0.5 rounded-xl tracking-wide whitespace-nowrap;
  }
  /* Checklist badges */
  .badge-build { @apply bg-blue-100 text-blue-800 dark:bg-blue-500/15 dark:text-blue-300; }
  .badge-types { @apply bg-indigo-100 text-indigo-800 dark:bg-indigo-500/20 dark:text-indigo-300; }
  .badge-config { @apply bg-pink-100 text-pink-800 dark:bg-pink-500/15 dark:text-pink-300; }
  .badge-deps { @apply bg-amber-100 text-amber-800 dark:bg-amber-500/15 dark:text-amber-300; }
  .badge-docs { @apply bg-emerald-100 text-emerald-800 dark:bg-emerald-500/15 dark:text-emerald-300; }
  .badge-prepublish { @apply bg-violet-100 text-violet-800 dark:bg-violet-500/20 dark:text-violet-300; }
  .badge-legal { @apply bg-slate-100 text-slate-600 dark:bg-slate-500/15 dark:text-slate-400; }
  /* Format badges */
  .rb-free { @apply bg-emerald-100 text-emerald-800 dark:bg-emerald-500/15 dark:text-emerald-300; }
  .rb-paid { @apply bg-amber-100 text-amber-800 dark:bg-amber-500/15 dark:text-amber-300; }
  .rb-docs { @apply bg-blue-100 text-blue-800 dark:bg-blue-500/15 dark:text-blue-300; }
  .rb-article { @apply bg-violet-100 text-violet-800 dark:bg-violet-500/20 dark:text-violet-300; }
  .rb-course { @apply bg-pink-100 text-pink-800 dark:bg-pink-500/15 dark:text-pink-300; }
  .rb-video { @apply bg-orange-100 text-orange-800 dark:bg-orange-500/15 dark:text-orange-300; }
  .rb-repo { @apply bg-slate-100 text-slate-600 dark:bg-slate-500/15 dark:text-slate-400; }
  .rb-interactive { @apply bg-teal-100 text-teal-800 dark:bg-teal-500/15 dark:text-teal-300; }
  /* Topic badges */
  .rb-publishing { @apply bg-yellow-100 text-yellow-800 dark:bg-yellow-500/15 dark:text-yellow-300; }
  .rb-typescript { @apply bg-sky-100 text-sky-700 dark:bg-sky-500/15 dark:text-sky-300; }
  .rb-versioning { @apply bg-purple-100 text-purple-700 dark:bg-purple-500/15 dark:text-purple-300; }
  .rb-ci-cd { @apply bg-indigo-100 text-indigo-800 dark:bg-indigo-500/15 dark:text-indigo-300; }
  .rb-monorepo { @apply bg-pink-100 text-pink-700 dark:bg-pink-500/15 dark:text-pink-300; }
  .rb-modules { @apply bg-lime-100 text-lime-800 dark:bg-lime-500/15 dark:text-lime-300; }
  .rb-tooling { @apply bg-slate-100 text-slate-700 dark:bg-slate-500/15 dark:text-slate-300; }
  .rb-bundling { @apply bg-orange-50 text-orange-800 dark:bg-orange-500/15 dark:text-orange-300; }
  .rb-testing { @apply bg-green-50 text-green-800 dark:bg-green-500/15 dark:text-green-300; }
  .rb-linting { @apply bg-fuchsia-50 text-fuchsia-800 dark:bg-fuchsia-500/15 dark:text-fuchsia-300; }
}

/* ── Body-level toggle rules ──────────────────────────────────────── */
body.sidebar-open .sidebar-overlay {
  @apply opacity-100 pointer-events-auto;
}
body.sidebar-open .sidebar {
  transform: translateX(0);
}
body.pnpm .cmd-pnpm { display: inline; }
body.pnpm .cmd-npm { display: none; }

/* ── Animations ───────────────────────────────────────────────────── */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(6px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ── Responsive ───────────────────────────────────────────────────── */
@media (max-width: 600px) {
  .sidebar { width: 280px !important; }
}
