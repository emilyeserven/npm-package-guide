---
id: "tl-workflow"
title: "Full Workflow ğŸ”„"
guide: "twelvelabs"
group: "Integration"
linkRefs:
  - id: "twelvelabs-docs"
    note: "Full API reference for all endpoints"
  - id: "twelvelabs-sdk"
    note: "JavaScript SDK documentation"
---

<SectionTitle>{frontmatter.title}</SectionTitle>

<Toc>
  <TocLink id="toc-complete">Complete Example</TocLink>
  <TocLink id="toc-frontend">Frontend Integration</TocLink>
</Toc>

<SectionIntro>
Here's a complete example that ties all the APIs together â€” creating an index, uploading a video, searching it, analyzing it, and generating embeddings.
</SectionIntro>

<SectionSubheading id="toc-complete">Complete Example</SectionSubheading>

<CodeAccordion title="complete-workflow.js" lang="js" open>
{`const client = new TwelveLabs({
  apiKey: process.env.TWELVELABS_API_KEY,
});

async function main() {
  // â”€â”€â”€ 1. Create an Index â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const index = await client.indexes.create({
    indexName: "product-demos",
    models: [
      { modelName: "marengo2.7", modelOptions: ["visual", "audio"] },
      { modelName: "pegasus1.2", modelOptions: ["visual", "audio"] },
    ],
  });
  console.log(\`âœ“ Index created: \${index.id}\`);

  // â”€â”€â”€ 2. Upload a Video â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const task = await client.tasks.create({
    indexId: index.id,
    videoFile: fs.createReadStream("./demo-video.mp4"),
    userMetadata: { type: "product-demo", version: "2.0" },
  });
  const completed = await client.tasks.waitForDone(task.id, {
    callback: (t) => console.log(\`  Indexing: \${t.status}\`),
  });
  console.log(\`âœ“ Video indexed: \${completed.videoId}\`);

  // â”€â”€â”€ 3. Search the Video â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const searchResults = await client.search.create({
    indexId: index.id,
    searchOptions: ["visual", "conversation"],
    query_text: "new feature walkthrough",
  });
  console.log("\\nğŸ” Search results:");
  for (const match of searchResults.data) {
    console.log(\`  \${match.start}s â†’ \${match.end}s (score: \${match.score})\`);
  }

  // â”€â”€â”€ 4. Analyze the Video â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const analysis = await client.analyze.create({
    videoId: completed.videoId,
    prompt: "Create a structured summary with title, overview, " +
           "key features demonstrated, and target audience.",
    temperature: 0.2,
    responseFormat: {
      type: "json_schema",
      jsonSchema: {
        type: "object",
        properties: {
          title: { type: "string" },
          overview: { type: "string" },
          features: {
            type: "array",
            items: { type: "string" },
          },
          targetAudience: { type: "string" },
        },
      },
    },
    maxTokens: 2000,
  });
  console.log("\\nğŸ“ Analysis:", JSON.parse(analysis));

  // â”€â”€â”€ 5. Generate Embeddings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const embedTask = await client.embed.tasks.create({
    modelName: "Marengo-retrieval-2.7",
    videoFile: fs.createReadStream("./demo-video.mp4"),
    videoEmbeddingScope: ["clip", "video"],
  });
  const embedResult = await client.embed.tasks.waitForDone(embedTask.id);
  const embeddings = await client.embed.tasks.retrieve(embedTask.id, {
    embeddingOption: ["visual-text"],
  });
  console.log(
    \`\\nâ¬¡ Generated \${embeddings.videoEmbedding.segments.length} embeddings\`
  );
}

main().catch(console.error);`}
</CodeAccordion>

<Explainer>
For production apps, consider using **TanStack Query** to manage API calls with caching, retries, and loading states. Wrap each TwelveLabs SDK call in a query function for automatic background refetching and stale-while-revalidate behavior.
</Explainer>

<SectionSubheading id="toc-frontend">Frontend Integration</SectionSubheading>

<CodeAccordion title="hooks/useTwelveLabs.ts â€” TanStack Query integration" lang="ts">
{`const client = new TwelveLabs({
  apiKey: import.meta.env.VITE_TWELVELABS_API_KEY,
});

// Fetch all indexes
export function useIndexes() {
  return useQuery({
    queryKey: ["twelvelabs", "indexes"],
    queryFn: () => client.indexes.list(),
  });
}

// Search videos
export function useVideoSearch(indexId: string, query: string) {
  return useQuery({
    queryKey: ["twelvelabs", "search", indexId, query],
    queryFn: () =>
      client.search.create({
        indexId,
        searchOptions: ["visual", "conversation"],
        query_text: query,
      }),
    enabled: !!query && !!indexId,
  });
}

// Upload video mutation
export function useUploadVideo() {
  return useMutation({
    mutationFn: async ({
      indexId,
      file,
    }: {
      indexId: string;
      file: File;
    }) => {
      const task = await client.tasks.create({
        indexId,
        videoFile: file,
      });
      return client.tasks.waitForDone(task.id);
    },
  });
}`}
</CodeAccordion>
