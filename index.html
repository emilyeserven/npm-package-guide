<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Web App vs. NPM Package</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --ink: #1a1a2e;
    --muted: #6b7280;
    --faint: #9ca3af;
    --indigo: #6366f1;
    --indigo-light: #e0e7ff;
    --blue: #3b82f6;
    --blue-bg: #eff6ff;
    --blue-border: #bfdbfe;
    --blue-divider: #dbeafe;
    --purple: #8b5cf6;
    --purple-bg: #faf5ff;
    --purple-border: #e9d5ff;
    --purple-divider: #f3e8ff;
    --green-bg: #f0fdf4;
    --green-border: #bbf7d0;
    --green-text: #166534;
    --green-body: #15803d;
    --green-check: #16a34a;
    --red-bg: #fef2f2;
    --red-border: #fecaca;
    --red-text: #991b1b;
    --yellow-bg: #fefce8;
    --yellow-border: #fde68a;
    --yellow-accent: #92400e;
    --yellow-light: #fef3c7;
    --code-bg: #1e293b;
    --code-text: #e2e8f0;
    --pill-bg: #f1f5f9;
    --pill-text: #475569;
    --radius: 12px;
    --radius-sm: 10px;
    --radius-pill: 20px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    color: var(--ink);
    background: #fafafa;
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
  }

  .container {
    max-width: 840px;
    margin: 0 auto;
    padding: 72px 20px 60px;
  }

  /* Page header - only shown on Start Here */
  .page-header { margin-bottom: 28px; }
  .page-header h1 {
    font-size: 26px;
    font-weight: 700;
    letter-spacing: -0.5px;
    margin-bottom: 4px;
  }
  .page-header .subtitle { color: var(--muted); font-size: 14px; margin-bottom: 4px; }
  .page-header .hint { color: var(--faint); font-size: 13px; margin-bottom: 0; }

  /* Floating header bar */
  .floating-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 50;
    background: rgba(255, 255, 255, 0.92);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-bottom: 1px solid #e2e8f0;
    padding: 0 20px;
    transition: box-shadow 0.2s ease;
  }

  .floating-header.scrolled {
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
  }

  .floating-header-inner {
    max-width: 840px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    height: 52px;
    gap: 14px;
  }

  .header-menu-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border: 1px solid #e2e8f0;
    background: #fff;
    border-radius: 9px;
    cursor: pointer;
    flex-shrink: 0;
    transition: all 0.15s;
  }

  .header-menu-btn:hover {
    border-color: var(--indigo);
    color: var(--indigo);
    box-shadow: 0 2px 6px rgba(99, 102, 241, 0.1);
  }

  .header-menu-icon {
    display: flex;
    flex-direction: column;
    gap: 3px;
  }

  .header-menu-icon span {
    display: block;
    width: 14px;
    height: 1.5px;
    background: currentColor;
    border-radius: 1px;
  }

  .header-section-name {
    font-size: 14px;
    font-weight: 600;
    color: var(--ink);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    min-width: 0;
  }

  .header-pm-switcher {
    margin-left: auto;
    position: relative;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .header-home-btn {
    display: flex;
    align-items: center;
    gap: 5px;
    font-family: inherit;
    font-size: 11px;
    font-weight: 600;
    padding: 5px 10px;
    border-radius: 8px;
    background: transparent;
    color: var(--muted);
    border: 1px solid #e2e8f0;
    cursor: pointer;
    transition: all 0.15s;
    white-space: nowrap;
  }

  .header-home-btn:hover {
    border-color: var(--indigo);
    color: var(--indigo);
  }

  .header-home-btn svg {
    width: 12px;
    height: 12px;
  }

  .header-pm-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    font-weight: 600;
    padding: 5px 10px;
    border-radius: 8px;
    background: var(--indigo-light);
    color: var(--indigo);
    border: 1px solid transparent;
    cursor: pointer;
    transition: all 0.15s;
  }

  .header-pm-btn:hover {
    border-color: var(--indigo);
    box-shadow: 0 2px 6px rgba(99, 102, 241, 0.12);
  }

  .header-pm-btn svg {
    width: 13px;
    height: 13px;
    opacity: 0.7;
    transition: transform 0.3s ease;
  }

  .header-pm-btn:hover svg { opacity: 1; transform: rotate(60deg); }

  .pm-dropdown {
    position: absolute;
    top: calc(100% + 6px);
    right: 0;
    background: #fff;
    border: 1px solid #e2e8f0;
    border-radius: 10px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    padding: 6px;
    z-index: 60;
    opacity: 0;
    pointer-events: none;
    transform: translateY(-4px);
    transition: all 0.15s ease;
    min-width: 120px;
  }

  .pm-dropdown.open {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
  }

  .pm-dropdown-item {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    padding: 8px 12px;
    border: none;
    background: transparent;
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    font-weight: 500;
    color: var(--muted);
    cursor: pointer;
    border-radius: 7px;
    transition: all 0.12s;
  }

  .pm-dropdown-item:hover {
    background: var(--indigo-light);
    color: var(--indigo);
  }

  .pm-dropdown-item.active {
    color: var(--indigo);
    font-weight: 700;
  }

  .pm-dropdown-item .pm-check {
    width: 16px;
    font-size: 13px;
    text-align: center;
  }

  .pm-dropdown-divider {
    height: 1px;
    background: #e2e8f0;
    margin: 4px 6px;
  }

  .pm-dropdown-link {
    font-family: 'DM Sans', system-ui, sans-serif;
    font-size: 11.5px;
    color: var(--indigo) !important;
    width: 100%;
    text-align: left;
  }

  /* Sidebar Drawer */
  .sidebar-overlay {
    position: fixed;
    inset: 0;
    background: rgba(15, 23, 42, 0.3);
    backdrop-filter: blur(2px);
    z-index: 90;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease;
  }

  body.sidebar-open .sidebar-overlay {
    opacity: 1;
    pointer-events: auto;
  }

  .sidebar {
    position: fixed;
    top: 0;
    left: 0;
    width: 300px;
    height: 100vh;
    background: #fff;
    z-index: 100;
    transform: translateX(-100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 4px 0 24px rgba(0, 0, 0, 0.08);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  body.sidebar-open .sidebar {
    transform: translateX(0);
  }

  .sidebar-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 18px 20px 14px;
    border-bottom: 1px solid #e2e8f0;
    flex-shrink: 0;
  }

  .sidebar-title {
    font-size: 15px;
    font-weight: 700;
    color: var(--ink);
    letter-spacing: -0.3px;
  }

  .sidebar-close {
    width: 32px;
    height: 32px;
    border: none;
    background: var(--pill-bg);
    border-radius: 8px;
    font-size: 16px;
    color: var(--muted);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
  }

  .sidebar-close:hover { background: #e2e8f0; color: var(--ink); }

  .sidebar-body {
    flex: 1;
    overflow-y: auto;
    padding: 12px 14px 24px;
  }

  .sidebar-group-label {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: var(--ink);
    padding: 18px 12px 8px;
    border-top: 1px solid #e2e8f0;
    margin-top: 4px;
  }

  .sidebar-group-label:first-child { padding-top: 4px; border-top: none; margin-top: 0; }

  .sidebar-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    text-align: left;
    padding: 9px 12px;
    border: none;
    background: transparent;
    font-family: inherit;
    font-size: 13.5px;
    font-weight: 400;
    color: var(--muted);
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.15s ease;
    line-height: 1.4;
  }

  .sidebar-item .sidebar-icon {
    font-size: 14px;
    filter: grayscale(1);
    opacity: 0.5;
    transition: all 0.15s;
  }

  .sidebar-item:hover .sidebar-icon {
    filter: grayscale(0);
    opacity: 1;
  }

  .sidebar-item:hover {
    background: var(--indigo-light);
    color: var(--indigo);
  }

  .sidebar-item.active {
    background: var(--indigo);
    color: #fff;
    font-weight: 600;
  }

  .sidebar-item.active .sidebar-icon {
    filter: grayscale(0);
    opacity: 1;
  }

  /* Section intro paragraph */
  .section-intro {
    font-size: 14.5px;
    color: var(--muted);
    line-height: 1.75;
    margin-bottom: 24px;
  }

  .section-intro strong {
    color: var(--ink);
    font-weight: 600;
  }

  .section-intro ul {
    margin: 10px 0 6px;
    padding-left: 20px;
    list-style: none;
  }

  .section-intro ul li {
    position: relative;
    padding: 3px 0 3px 8px;
  }

  .section-intro ul li::before {
    content: '‚Üí';
    position: absolute;
    left: -16px;
    color: var(--indigo);
    font-weight: 600;
  }

  /* Section */
  .section { display: none; animation: fadeIn 0.25s ease; }
  .section.active { display: block; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

  .section-title { font-size: 24px; font-weight: 700; margin-bottom: 20px; letter-spacing: -0.4px; }

  /* Columns ‚Äî flat sections with headers */
  .columns { display: flex; gap: 24px; flex-wrap: wrap; }

  .col {
    flex: 1 1 300px;
    border-radius: 0;
    padding: 0;
    border: none;
    background: none;
  }

  .col--webapp, .col--pkg, .col--monolith, .col--monorepo {
    background: none;
    border-color: transparent;
  }

  .col-label {
    font-size: 17px;
    font-weight: 700;
    color: var(--ink);
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 2px solid #e2e8f0;
  }

  .col--webapp .col-label { border-bottom-color: var(--blue); }
  .col--pkg .col-label { border-bottom-color: var(--purple); }
  .col--monolith .col-label { border-bottom-color: #c2410c; }
  .col--monorepo .col-label { border-bottom-color: #047857; }

  .col-item {
    font-size: 14px;
    line-height: 1.65;
    padding: 9px 0 9px 16px;
    position: relative;
    border-bottom: 1px solid #f1f5f9;
  }

  .col-item:last-child { border-bottom: none; }

  .section-list {
    margin-bottom: 20px;
  }

  .col-item::before {
    content: '‚Ä¢';
    position: absolute;
    left: 0;
    color: var(--muted);
    font-weight: 700;
    font-size: 14px;
  }

  /* Prev/Next navigation */
  .section-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 32px;
    padding-top: 20px;
    border-top: 1px solid #e2e8f0;
    gap: 12px;
  }

  .section-nav-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 9px 16px;
    border: 1px solid #e2e8f0;
    background: #fff;
    border-radius: 9px;
    font-family: inherit;
    font-size: 13px;
    font-weight: 500;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.15s;
    max-width: 45%;
  }

  .section-nav-btn:hover {
    border-color: var(--indigo);
    color: var(--indigo);
    box-shadow: 0 2px 6px rgba(99, 102, 241, 0.1);
  }

  .section-nav-btn .nav-arrow {
    font-size: 15px;
    flex-shrink: 0;
  }

  .section-nav-btn .nav-label {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .section-nav-btn.next { margin-left: auto; }
  .section-nav-btn.prev { margin-right: auto; }

  /* Explainer */
  .explainer {
    margin-top: 24px;
  }

  .explainer-heading {
    font-size: 15px;
    font-weight: 700;
    color: var(--ink);
    margin-bottom: 8px;
  }

  .explainer-body {
    font-size: 14px;
    line-height: 1.75;
    color: var(--muted);
  }

  /* Accordion ‚Äî for optional collapsible content */
  .accordion {
    margin-top: 16px;
    border: 1px solid #e2e8f0;
    border-radius: var(--radius-sm);
    overflow: hidden;
  }

  .accordion-toggle {
    width: 100%;
    padding: 13px 18px;
    background: #f8fafc;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-family: inherit;
    font-size: 14px;
    font-weight: 600;
    color: var(--ink);
    transition: background 0.15s;
  }

  .accordion-toggle:hover { background: #f1f5f9; }

  .accordion-arrow {
    font-size: 11px;
    transition: transform 0.2s ease;
    display: inline-block;
  }

  .accordion-arrow.open { transform: rotate(180deg); }

  .accordion-body {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease, padding 0.3s ease;
    padding: 0 18px;
  }

  .accordion-body.open {
    max-height: 2000px;
    padding: 0 18px 16px;
  }

  /* Gotcha */
  .gotcha {
    margin-top: 0;
    font-size: 14px;
    line-height: 1.65;
    color: var(--muted);
  }
    font-size: 13px;
    color: var(--red-text);
    line-height: 1.65;
  }

  /* Code Block */
  .code-block {
    margin-top: 16px;
    background: var(--code-bg);
    color: var(--code-text);
    border-radius: var(--radius-sm);
    padding: 20px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    line-height: 1.75;
    overflow-x: auto;
    white-space: pre-wrap;
    word-break: break-word;
  }

  .code-block .comment { color: #64748b; }
  .code-block .key { color: #7dd3fc; }
  .code-block .string { color: #86efac; }

  /* Checklist */
  .checklist-title { font-size: 24px; font-weight: 700; margin-bottom: 4px; letter-spacing: -0.4px; }
  .checklist-sub { font-size: 13px; color: var(--muted); margin-bottom: 22px; }
  .checklist-sub code { background: var(--pill-bg); padding: 2px 7px; border-radius: 4px; font-family: 'JetBrains Mono', monospace; font-size: 12px; }

  .check-item {
    display: flex;
    align-items: center;
    gap: 11px;
    padding: 10px 0;
    font-size: 14px;
    border-bottom: 1px solid #e2e8f0;
    cursor: pointer;
    transition: opacity 0.2s;
    user-select: none;
  }

  .check-item:last-of-type { border-bottom: none; }
  .check-item.checked { opacity: 0.55; text-decoration: line-through; color: var(--green-check); }

  .check-item input[type="checkbox"] {
    accent-color: var(--green-check);
    flex-shrink: 0;
    width: 16px;
    height: 16px;
    cursor: pointer;
  }

  .check-item .label { flex: 1; }

  .check-badge {
    font-size: 10px;
    font-weight: 600;
    padding: 2px 9px;
    border-radius: 10px;
    flex-shrink: 0;
    letter-spacing: 0.3px;
  }

  .badge-build { background: #dbeafe; color: #1e40af; }
  .badge-types { background: #e0e7ff; color: #3730a3; }
  .badge-config { background: #fce7f3; color: #9d174d; }
  .badge-deps { background: #fef3c7; color: #92400e; }
  .badge-docs { background: #d1fae5; color: #065f46; }
  .badge-prepublish { background: #ede9fe; color: #5b21b6; }
  .badge-legal { background: #f1f5f9; color: #475569; }

  /* Progress bar */
  .progress-row { display: flex; align-items: center; gap: 12px; margin-top: 22px; }
  .progress-track { flex: 1; height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; }
  .progress-fill { height: 100%; background: var(--green-check); border-radius: 4px; transition: width 0.35s ease; }
  .progress-label { font-size: 13px; color: var(--muted); font-weight: 600; flex-shrink: 0; }

  .checklist-copy-btn {
    display: inline-flex;
    align-items: center;
    gap: 7px;
    margin-bottom: 18px;
    padding: 8px 16px;
    border: 1px solid #e2e8f0;
    background: #fff;
    border-radius: 9px;
    font-family: inherit;
    font-size: 13px;
    font-weight: 600;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.15s;
  }

  .checklist-copy-btn:hover {
    border-color: var(--indigo);
    color: var(--indigo);
    box-shadow: 0 2px 6px rgba(99, 102, 241, 0.1);
  }

  .checklist-copy-btn.copied {
    border-color: var(--green-check);
    color: var(--green-check);
  }

  /* Package manager toggle */
  .pm-toggle-group {
    display: inline-flex;
    background: #e2e8f0;
    border-radius: 8px;
    overflow: hidden;
  }

  .pm-toggle-btn {
    padding: 6px 16px;
    border: none;
    background: transparent;
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    font-weight: 600;
    color: var(--pill-text);
    cursor: pointer;
    transition: all 0.15s;
  }

  .pm-toggle-btn.active {
    background: var(--indigo);
    color: #fff;
    border-radius: 6px;
  }

  .cmd {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    background: #e2e8f0;
    padding: 2px 6px;
    border-radius: 4px;
    color: var(--ink);
  }

  .cmd-pnpm { display: none; }
  .cmd-npm { display: inline; }

  body.pnpm .cmd-pnpm { display: inline; }
  body.pnpm .cmd-npm { display: none; }

  /* Steps / Roadmap */
  .roadmap-intro {
    font-size: 14px;
    color: var(--muted);
    line-height: 1.65;
    margin-bottom: 24px;
  }

  .step-card {
    display: flex;
    gap: 16px;
    padding: 18px 0;
    border-bottom: 1px solid #e2e8f0;
    position: relative;
  }

  .step-card:last-child { border-bottom: none; }

  .step-number {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--indigo);
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: 700;
    flex-shrink: 0;
    position: relative;
  }

  .step-card:not(:last-child) .step-number::after {
    content: '';
    position: absolute;
    top: 38px;
    left: 50%;
    transform: translateX(-50%);
    width: 2px;
    height: calc(100% + 4px);
    background: var(--indigo-light);
  }

  .step-content { flex: 1; min-width: 0; }

  .step-title {
    font-size: 15px;
    font-weight: 700;
    color: var(--ink);
    margin-bottom: 4px;
  }

  .step-desc {
    font-size: 13.5px;
    color: var(--muted);
    line-height: 1.65;
    margin-bottom: 8px;
  }

  .step-detail {
    font-size: 12.5px;
    color: var(--faint);
    line-height: 1.6;
    background: #f8fafc;
    border-radius: 8px;
    padding: 10px 14px;
    margin-bottom: 8px;
    border: 1px solid #f1f5f9;
  }

  .step-detail code {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11.5px;
    background: #e2e8f0;
    padding: 1px 5px;
    border-radius: 3px;
    color: var(--ink);
  }

  .step-jump {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    font-weight: 700;
    color: #fff;
    cursor: pointer;
    background: var(--indigo);
    border: none;
    font-family: inherit;
    padding: 7px 14px;
    border-radius: 8px;
    transition: all 0.15s;
    margin-top: 4px;
    box-shadow: 0 2px 6px rgba(99, 102, 241, 0.25);
  }

  .step-jump:hover {
    background: #4f46e5;
    transform: translateY(-1px);
    box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3);
  }

  .step-card.has-jump {
    /* no special border ‚Äî deep dive button is sufficient indicator */
  }

  .bonus-step {
    margin-top: 12px;
    border-top: 2px dashed #cbd5e1;
    padding-top: 24px;
  }

  .bonus-number {
    background: linear-gradient(135deg, #f59e0b, #d97706) !important;
    font-size: 15px !important;
  }

  .bonus-step .step-number::after {
    display: none !important;
  }

  .step-substep {
    margin-top: 10px;
    padding-left: 14px;
    border-left: 2px solid #e2e8f0;
  }

  .step-substep-text {
    font-size: 13px;
    color: var(--muted);
    line-height: 1.6;
  }

  .bonus-links {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 12px;
  }

  .bonus-links .step-jump {
    font-size: 12px;
    padding: 6px 12px;
  }

  /* Resources table */
  .resources-section {
    margin-top: 40px;
    padding-top: 32px;
    border-top: 2px solid #e2e8f0;
  }

  .resources-title {
    font-size: 19px;
    font-weight: 700;
    margin-bottom: 6px;
    letter-spacing: -0.3px;
  }

  .resources-subtitle {
    font-size: 13px;
    color: var(--muted);
    margin-bottom: 20px;
    line-height: 1.5;
  }

  .resources-category {
    font-size: 13px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: var(--muted);
    padding: 10px 0 6px;
    border-bottom: 1px solid #e2e8f0;
    margin-top: 20px;
    margin-bottom: 0;
  }

  .resources-category:first-of-type { margin-top: 0; }

  .resource-row {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 11px 0;
    border-bottom: 1px solid #f1f5f9;
    font-size: 13.5px;
    flex-wrap: wrap;
  }

  .resource-row:last-child { border-bottom: none; }

  .resource-link {
    color: var(--indigo);
    text-decoration: none;
    font-weight: 500;
    flex: 1;
    min-width: 200px;
  }

  .resource-link:hover { text-decoration: underline; }

  .resource-desc {
    color: var(--muted);
    font-size: 12px;
    flex: 1.5;
    min-width: 200px;
  }

  .resource-badges {
    display: flex;
    gap: 5px;
    flex-shrink: 0;
  }

  .resource-badge {
    font-size: 10px;
    font-weight: 600;
    padding: 2px 8px;
    border-radius: 10px;
    letter-spacing: 0.3px;
    white-space: nowrap;
  }

  .rb-free { background: #d1fae5; color: #065f46; }
  .rb-paid { background: #fef3c7; color: #92400e; }
  .rb-docs { background: #dbeafe; color: #1e40af; }
  .rb-article { background: #ede9fe; color: #5b21b6; }
  .rb-course { background: #fce7f3; color: #9d174d; }
  .rb-video { background: #ffedd5; color: #9a3412; }
  .rb-repo { background: #f1f5f9; color: #475569; }
  .rb-interactive { background: #ccfbf1; color: #0f766e; }

  /* Links / Resources */
  .links-section {
    margin-top: 24px;
    border-top: 1px solid #e2e8f0;
    padding-top: 16px;
  }

  .links-heading {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--muted);
    margin-bottom: 10px;
  }

  .links-list {
    display: flex;
    flex-direction: column;
    gap: 0;
    counter-reset: footnote;
  }

  .footnote-item {
    display: flex;
    align-items: baseline;
    gap: 8px;
    padding: 6px 0;
    border-bottom: 1px solid #f1f5f9;
    font-size: 13px;
    line-height: 1.5;
  }

  .footnote-item:last-child { border-bottom: none; }

  .footnote-num {
    font-size: 11px;
    font-weight: 700;
    color: var(--indigo);
    min-width: 18px;
    flex-shrink: 0;
  }

  .footnote-link {
    color: var(--indigo);
    text-decoration: none;
    font-weight: 500;
  }

  .footnote-link:hover { text-decoration: underline; }

  .footnote-source {
    font-size: 10px;
    font-weight: 600;
    color: var(--pill-text);
    background: var(--pill-bg);
    padding: 1px 6px;
    border-radius: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-left: 4px;
  }

  .footnote-note {
    color: var(--muted);
    font-size: 12px;
    margin-left: 4px;
  }

  sup.fn-ref {
    font-size: 10px;
    font-weight: 700;
    color: #fff;
    background: var(--indigo);
    border-radius: 4px;
    padding: 0 4px;
    margin-left: 2px;
    cursor: pointer;
    text-decoration: none;
    transition: background 0.15s;
    vertical-align: super;
    line-height: 1;
  }

  sup.fn-ref:hover {
    background: #4338ca;
  }

  /* Copyable AI prompts */
  .ai-prompt-card {
    margin-bottom: 14px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    overflow: hidden;
  }

  .ai-prompt-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 14px;
    background: #f8fafc;
    border-bottom: 1px solid #e2e8f0;
  }

  .ai-prompt-label {
    font-weight: 700;
    font-size: 13px;
    color: var(--ink);
  }

  .ai-prompt-copy {
    font-family: inherit;
    font-size: 11px;
    font-weight: 600;
    padding: 4px 10px;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    background: #fff;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.15s;
  }

  .ai-prompt-copy:hover { border-color: var(--indigo); color: var(--indigo); }
  .ai-prompt-copy.copied { border-color: #22c55e; color: #22c55e; background: #f0fdf4; }

  .ai-prompt-body {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    padding: 10px 14px;
    line-height: 1.6;
    color: var(--muted);
    white-space: pre-wrap;
  }

  .inline-nav-link {
    font-family: inherit;
    font-size: inherit;
    font-weight: 600;
    color: var(--indigo);
    background: none;
    border: none;
    padding: 0;
    cursor: pointer;
    text-decoration: underline;
    text-decoration-style: dotted;
    text-underline-offset: 2px;
  }

  .inline-nav-link:hover {
    text-decoration-style: solid;
  }

  .inline-nav-pill {
    display: inline-flex;
    align-items: center;
    font-family: inherit;
    font-size: 13px;
    font-weight: 500;
    color: var(--indigo);
    background: var(--indigo-light);
    border: 1px solid rgba(99, 102, 241, 0.2);
    padding: 8px 14px;
    border-radius: 9px;
    cursor: pointer;
    transition: all 0.15s;
    line-height: 1.4;
    text-align: left;
  }

  .inline-nav-pill:hover {
    border-color: var(--indigo);
    box-shadow: 0 2px 6px rgba(99, 102, 241, 0.12);
    transform: translateY(-1px);
  }

  .link-chip {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 6px 12px;
    border-radius: 8px;
    background: #fff;
    border: 1px solid #e2e8f0;
    font-size: 12.5px;
    font-weight: 500;
    color: var(--indigo);
    text-decoration: none;
    transition: all 0.15s ease;
  }

  .link-chip:hover {
    background: var(--indigo-light);
    border-color: var(--indigo);
    transform: translateY(-1px);
    box-shadow: 0 2px 6px rgba(99, 102, 241, 0.15);
  }

  .link-chip .link-source {
    font-size: 10px;
    font-weight: 600;
    color: var(--pill-text);
    background: var(--pill-bg);
    padding: 1px 6px;
    border-radius: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* CI Pipeline section */
  .ci-step {
    margin-bottom: 24px;
    padding-bottom: 24px;
    border-bottom: 1px solid #e2e8f0;
  }

  .ci-step:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }

  .ci-step-heading {
    font-size: 17px;
    font-weight: 700;
    margin-bottom: 8px;
    color: var(--ink);
  }

  /* Section subheading ‚Äî used for inline headers in long content */
  .section-subheading {
    font-size: 15px;
    font-weight: 700;
    color: var(--ink);
    margin-top: 20px;
    margin-bottom: 8px;
  }

  .section-subheading:first-child { margin-top: 0; }

  /* Table of contents */
  .section-toc {
    margin-bottom: 24px;
    padding: 14px 18px;
    background: #f8fafc;
    border-radius: 10px;
    border: 1px solid #e2e8f0;
  }

  .section-toc-title {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: var(--muted);
    margin-bottom: 8px;
  }

  .section-toc a {
    display: block;
    font-size: 13px;
    color: var(--indigo);
    text-decoration: none;
    padding: 3px 0;
    transition: color 0.15s;
  }

  .section-toc a:hover {
    color: var(--ink);
  }

  /* YAML heading label */
  .yaml-heading {
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.6px;
    color: var(--muted);
    margin-bottom: 6px;
    margin-top: 16px;
  }

  .ci-step-text {
    font-size: 14px;
    line-height: 1.7;
    color: var(--muted);
    margin-bottom: 12px;
  }

  .ci-yaml {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    line-height: 1.6;
    background: #1e293b;
    color: #e2e8f0;
    padding: 12px 16px;
    border-radius: 8px;
    margin-bottom: 10px;
    white-space: pre-wrap;
    overflow-x: auto;
  }

  .ci-tip {
    font-size: 13px;
    color: var(--indigo);
    background: var(--indigo-light);
    padding: 10px 14px;
    border-radius: 8px;
    line-height: 1.6;
  }

  .ci-tip::before {
    content: 'üí° ';
  }

  /* Good tests bullet list */
  .good-tests-list {
    list-style: disc;
    padding-left: 20px;
    margin: 0;
  }

  .good-tests-list li {
    margin-bottom: 8px;
    line-height: 1.65;
  }

  .good-tests-list li:last-child { margin-bottom: 0; }

  /* AI prompt blocks */
  .ai-prompt-block {
    margin-bottom: 16px;
  }

  .ai-prompt-block:last-child { margin-bottom: 0; }

  .ai-prompt-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
  }

  .ai-prompt-label {
    font-weight: 700;
    font-size: 13px;
    color: var(--ink);
  }

  .ai-prompt-copy {
    font-family: inherit;
    font-size: 11px;
    font-weight: 600;
    padding: 4px 10px;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    background: #fff;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.15s;
    flex-shrink: 0;
  }

  .ai-prompt-copy:hover {
    border-color: var(--indigo);
    color: var(--indigo);
  }

  .ai-prompt-copy.copied {
    border-color: #10b981;
    color: #10b981;
    background: #ecfdf5;
  }

  .ai-prompt-text {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    background: #f1f5f9;
    padding: 10px 14px;
    border-radius: 8px;
    line-height: 1.6;
    color: var(--muted);
    white-space: pre-wrap;
  }

  .ci-full-example {
    margin-top: 28px;
  }

  .ci-full-example-label {
    font-size: 14px;
    font-weight: 700;
    color: var(--ink);
    margin-bottom: 10px;
  }

  .ci-overview-cards {
    display: flex;
    flex-direction: column;
    gap: 16px;
    margin-bottom: 24px;
  }

  .ci-overview-card {
    display: flex;
    gap: 14px;
    padding: 16px;
    border: 1px solid #e2e8f0;
    border-radius: 10px;
    background: #fafbfc;
  }

  .ci-overview-num {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--indigo);
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
    font-weight: 700;
    flex-shrink: 0;
  }

  .ci-overview-card-body { flex: 1; min-width: 0; }

  .ci-overview-card-title {
    font-size: 15px;
    font-weight: 700;
    color: var(--ink);
    margin-bottom: 8px;
  }

  @media (max-width: 600px) {
    .container { padding: 64px 14px 40px; }
    .col { padding: 16px; }
    .sidebar { width: 280px; }
    .header-section-name { font-size: 13px; }
  }
</style>
</head>
<body>

<div class="floating-header" id="floating-header">
  <div class="floating-header-inner">
    <button class="header-menu-btn" id="menu-toggle" aria-label="Open navigation">
      <span class="header-menu-icon"><span></span><span></span><span></span></span>
    </button>
    <span class="header-section-name" id="header-section-name"></span>
    <div class="header-pm-switcher" id="pm-switcher">
      <button class="header-home-btn" id="header-home-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        Start Here
      </button>
      <button class="header-pm-btn" id="pm-toggle-btn">
        <span id="header-pm-label">npm</span>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      </button>
      <div class="pm-dropdown" id="pm-dropdown">
        <button class="pm-dropdown-item active" data-pm="npm"><span class="pm-check">‚úì</span> npm</button>
        <button class="pm-dropdown-item" data-pm="pnpm"><span class="pm-check"></span> pnpm</button>
        <div class="pm-dropdown-divider"></div>
        <button class="pm-dropdown-item pm-dropdown-link" id="pm-learn-more">npm vs pnpm</button>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div id="page-header"></div>
  <div id="content"></div>
</div>

<div class="sidebar-overlay" id="sidebar-overlay"></div>
<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <span class="sidebar-title">Navigation</span>
    <button class="sidebar-close" id="sidebar-close">‚úï</button>
  </div>
  <div class="sidebar-body" id="sidebar-body"></div>
</div>

<script>
let currentPM = "npm";

// Helper to render dual npm/pnpm commands inline
function cmd(npmCmd, pnpmCmd) {
  return `<span class="cmd cmd-npm">${npmCmd}</span><span class="cmd cmd-pnpm">${pnpmCmd || npmCmd.replace(/\bnpm\b/g, 'pnpm')}</span>`;
}

// Sidebar open/close
function openSidebar() { document.body.classList.add("sidebar-open"); }
function closeSidebar() { document.body.classList.remove("sidebar-open"); }

document.getElementById("menu-toggle").addEventListener("click", openSidebar);
document.getElementById("sidebar-close").addEventListener("click", closeSidebar);
document.getElementById("sidebar-overlay").addEventListener("click", closeSidebar);
document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeSidebar(); });

// Floating header scroll shadow
window.addEventListener("scroll", () => {
  document.getElementById("floating-header").classList.toggle("scrolled", window.scrollY > 8);
});

// PM dropdown toggle
const pmToggleBtn = document.getElementById("pm-toggle-btn");
const pmDropdown = document.getElementById("pm-dropdown");

pmToggleBtn.addEventListener("click", (e) => {
  e.stopPropagation();
  pmDropdown.classList.toggle("open");
});

document.addEventListener("click", () => { pmDropdown.classList.remove("open"); });

function setupPMDropdown() {
  pmDropdown.querySelectorAll(".pm-dropdown-item[data-pm]").forEach(btn => {
    btn.addEventListener("click", (e) => {
      e.stopPropagation();
      currentPM = btn.dataset.pm;
      document.body.classList.toggle("pnpm", currentPM === "pnpm");
      pmDropdown.classList.remove("open");
      render();
    });
  });
}

document.getElementById("pm-learn-more").addEventListener("click", (e) => {
  e.stopPropagation();
  pmDropdown.classList.remove("open");
  activeSection = "npm-vs-pnpm";
  render();
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

// Home button ‚Äî go to roadmap and scroll to next step
document.getElementById("header-home-btn").addEventListener("click", () => {
  // Find which roadmap step corresponds to the current section
  let scrollToStep = -1;
  if (activeSection !== "roadmap") {
    const stepIdx = roadmapSteps.findIndex(s => s.jumpTo === activeSection);
    // Scroll to the NEXT step after the current one
    scrollToStep = stepIdx >= 0 ? stepIdx + 1 : -1;
  }
  activeSection = "roadmap";
  render();
  if (scrollToStep >= 0 && scrollToStep < roadmapSteps.length) {
    setTimeout(() => {
      const cards = document.querySelectorAll(".step-card");
      if (cards[scrollToStep]) {
        cards[scrollToStep].scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }, 50);
  } else {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
});

// Full navigation order for prev/next
function getNavOrder() {
  const conceptIds = sections.filter(s => s.group === "concepts").map(s => s.id);
  const comparisonIds = sections.filter(s => s.group !== "concepts" && s.id !== "bigpicture").map(s => s.id);
  return ["roadmap", "bigpicture", ...conceptIds, ...comparisonIds, ...ciPageIds, ...bonusIds, "checklist", "overall-resources", "section-links"];
}

function getNavTitle(id) {
  if (id === "roadmap") return "üöÄ Start Here";
  if (id === "checklist") return "‚úÖ Publish Checklist";
  if (id === "overall-resources") return "üìö Learning Resources";
  if (id === "section-links") return "üîó Section References";
  const ci = ciPages.find(p => p.id === id);
  if (ci) return ci.title;
  const bonus = bonusSections.find(b => b.id === id);
  if (bonus) return bonus.title;
  const s = sections.find(s => s.id === id);
  return s ? s.title : id;
}

const sections = [
  {
    id: "bigpicture",
    title: "üó∫Ô∏è Big Picture",
    webapp: [
      "A web app is a complete, running application ‚Äî like a website or dashboard that people open in their browser.",
      "You control everything: the server, the build tools, the framework, and how users interact with it.",
      "Think of it like deploying a backend service, except the output runs in the browser instead of on a server."
    ],
    pkg: [
      "An npm package" + fnRef(1) + " is a reusable library that other developers install into THEIR projects ‚Äî like a pip package in Python or a gem in Ruby.",
      "You don't control how it's used. Someone might use it in React, Vue, plain JS, or even Node.js on a server.",
      "Think of it like writing a shared library or SDK ‚Äî your job is to make it easy and reliable for other devs to use. See the npm packages guide" + fnRef(2) + " for more on how packages work, and the JavaScript modules overview" + fnRef(3) + " for how modern JS imports and exports function."
    ],
    links: [
      { label: "What is npm?", url: "https://docs.npmjs.com/about-npm", source: "npm" },
      { label: "Getting started with npm packages", url: "https://docs.npmjs.com/packages-and-modules", source: "npm" },
      { label: "JavaScript modules overview", url: "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules", source: "MDN" }
    ]
  },
  {
    id: "monorepo",
    title: "üèóÔ∏è Monorepo vs Monolith",
    group: "concepts",
    intro: "Before you write any code, you need to decide how your project will be structured at the repo level. In the JavaScript ecosystem, there are two main approaches: a monolith (one project, one package.json, everything in one place) and a monorepo (one Git repo containing multiple independent packages that can be built, tested, and published separately). This choice affects your tooling, your dependency management, and how you collaborate with other developers.",
    customColumns: true,
    col1Label: "üß± Monolith",
    col1Class: "col--monolith",
    col1: [
      "A monolith is one repo, one package.json, one build. Everything lives together in a single project with no internal boundaries.",
      "For web apps, this is usually the right call. Apps have one deploy target and one user ‚Äî splitting into packages adds overhead without much benefit. Frameworks like Next.js and Remix are designed around this model.",
      "The risk: as a monolith grows, code becomes tangled. Shared utilities get imported from deep paths, there's no clear ownership, and refactoring gets scary. But for most apps, this tradeoff is worth the simplicity."
    ],
    col2Label: "üì¶ Monorepo",
    col2Class: "col--monorepo",
    col2: [
      "A monorepo is one Git repo containing multiple packages, each with its own package.json. They can depend on each other and be published independently ‚Äî this is the recommended structure for npm packages.",
      "This is NOT a monolith. Each package has clear boundaries, its own API surface, its own tests. Think of it like microservices in one repo ‚Äî the code is colocated for convenience, but the separation is real and enforced.",
      "For packages, monorepos improve modularity from the start. Instead of one giant package, you split into focused scoped packages (e.g., @myorg/utils, @myorg/components, @myorg/cli) that are easier to test, version, and maintain independently. Use pnpm workspaces" + fnRef(1) + " or npm workspaces" + fnRef(2) + " to manage them."
    ],
    gotcha: "‚ö†Ô∏è A monorepo is not a monolith! The whole point is improved modularity. Each package should have a single responsibility, its own tests, and a clean public API. If your packages are tightly coupled and can't be used independently, you've built a monolith with extra folders ‚Äî not a real monorepo.",
    explainerTitle: "Monorepo vs monolith ‚Äî a backend analogy",
    explainerBody: "Think of a monolith like a single Django or Spring Boot app ‚Äî one codebase, everything coupled, hard to split later. A monorepo is more like having your API server, worker service, and shared library all in one Git repo, but each can be built, tested, and deployed independently. The repo is shared, but the boundaries between projects are real and enforced. This is why monorepos improve modularity ‚Äî they force you to define clean interfaces between packages instead of letting everything bleed together. Tools like Turborepo" + fnRef(3) + " and Nx" + fnRef(4) + " make this practical by caching builds, running only affected tests, and parallelizing tasks. Lerna" + fnRef(5) + " (now maintained by Nx) coordinates version bumps and publishing across packages. pnpm is the preferred package manager for monorepos ‚Äî its workspace support is faster and stricter than npm's, with better dependency isolation that prevents packages from accidentally importing things they haven't declared.",
    links: [
      { label: "pnpm Workspaces docs", url: "https://pnpm.io/workspaces", source: "pnpm" },
      { label: "npm Workspaces docs", url: "https://docs.npmjs.com/cli/v10/using-npm/workspaces", source: "npm" },
      { label: "Turborepo ‚Äî Getting Started", url: "https://turbo.build/repo/docs", source: "Turborepo" },
      { label: "Nx ‚Äî Getting Started", url: "https://nx.dev/getting-started/intro", source: "Nx" },
      { label: "Lerna ‚Äî Modern monorepo management", url: "https://lerna.js.org/", source: "Lerna" }
    ]
  },
  {
    id: "npm-vs-pnpm",
    title: "üì¶ npm vs pnpm",
    group: "concepts",
    intro: "npm and pnpm are both package managers for JavaScript ‚Äî they install dependencies, run scripts, and manage your project's node_modules. npm comes bundled with Node.js and is the default, while pnpm" + fnRef(1) + " is a faster, stricter alternative that's become the preferred choice for monorepos and large projects. You can switch between them on any project, but it's best to pick one early and stick with it.",
    customColumns: true,
    col1Label: "üìó npm",
    col1Class: "col--webapp",
    col1: [
      "npm (Node Package Manager) is the default ‚Äî it ships with every Node.js installation, so there's nothing extra to install. If you're new to JavaScript, this is where you start.",
      "It uses a flat node_modules structure, which can lead to 'phantom dependencies' ‚Äî your code can accidentally import packages you didn't explicitly install. This is rarely a problem for small projects.",
      "npm workspaces support monorepos, but the implementation is basic. For single-package repos and getting started, npm is the simplest choice with the most community examples. See the npm CLI docs" + fnRef(3) + " for the full command reference."
    ],
    col2Label: "üü† pnpm",
    col2Class: "col--pkg",
    col2: [
      "pnpm is a drop-in replacement for npm that's significantly faster (2-3x in benchmarks) and uses much less disk space by symlinking packages from a shared store instead of copying them.",
      "It uses a strict node_modules structure that prevents phantom dependencies ‚Äî you can only import what you've explicitly declared. This catches real bugs that npm silently ignores.",
      "pnpm's workspace support is more mature and performant than npm's, which is why it's the recommended package manager for monorepos. Most major open-source projects (Vue, Vite, Turborepo) use pnpm. See the pnpm CLI docs" + fnRef(4) + " and the install guide" + fnRef(5) + " to get started."
    ],
    gotcha: "‚ö†Ô∏è Some older tutorials and boilerplates assume npm. If you see 'npm install', you can almost always substitute 'pnpm install' ‚Äî the commands are nearly identical. The main gotcha: pnpm's strict dependency resolution means packages that rely on phantom dependencies may break. This is actually pnpm catching a real bug, not a pnpm issue. See the feature comparison" + fnRef(2) + " for a detailed breakdown.",
    explainerTitle: "npm vs pnpm ‚Äî a backend analogy",
    explainerBody: "Think of npm like pip ‚Äî it comes with the language runtime, it works, and everyone knows it. pnpm is more like Poetry for Python or Cargo for Rust ‚Äî a more modern, opinionated tool that enforces best practices. The symlink-based store in pnpm is similar to how Docker layers share common base images instead of duplicating them ‚Äî you save disk space and gain speed because shared packages only exist once on your machine. The strict dependency resolution is like having your imports validated at compile time rather than discovering missing dependencies at runtime.",
    links: [
      { label: "pnpm ‚Äî Motivation", url: "https://pnpm.io/motivation", source: "pnpm" },
      { label: "pnpm vs npm ‚Äî Feature Comparison", url: "https://pnpm.io/feature-comparison", source: "pnpm" },
      { label: "npm CLI docs", url: "https://docs.npmjs.com/cli/v10/commands", source: "npm" },
      { label: "pnpm CLI docs", url: "https://pnpm.io/cli/add", source: "pnpm" },
      { label: "Install pnpm", url: "https://pnpm.io/installation", source: "pnpm" }
    ]
  },
  {
    id: "tsconfig",
    title: "‚öôÔ∏è tsconfig.json",
    group: "concepts",
    intro: "Every TypeScript project has a <strong>tsconfig.json</strong>" + fnRef(1) + " file at its root ‚Äî this is the configuration file that tells the TypeScript compiler how to process your code. It controls things like which JavaScript version to target, how strict the type checking should be, where to find source files, and where to put compiled output. Think of it like a Makefile or build.gradle for TypeScript ‚Äî it defines the rules for how your code gets compiled. You'll rarely write one from scratch; most projects start from a template" + fnRef(3) + " and tweak a few settings.",
    customColumns: true,
    col1Label: "üîß Key Settings",
    col1Class: "col--webapp",
    col1: [
      "<strong>target</strong> ‚Äî Which JavaScript version to compile to (e.g., ES2020, ES2022). Older targets = more compatibility, newer targets = smaller output. For packages, ES2020+ is a safe modern baseline.",
      "<strong>module / moduleResolution</strong>" + fnRef(4) + " ‚Äî How imports and exports work. Use \"NodeNext\" for packages (supports both ESM and CJS) or \"ESNext\" for apps with a bundler.",
      "<strong>strict</strong> ‚Äî Enables all strict type-checking options. Always set this to true ‚Äî it catches real bugs and is expected by consumers of your package."
    ],
    col2Label: "üìÅ Paths & Output",
    col2Class: "col--pkg",
    col2: [
      "<strong>rootDir</strong> ‚Äî Where your source code lives (usually \"./src\"). The compiler mirrors this structure in the output directory.",
      "<strong>outDir</strong> ‚Äî Where compiled JavaScript goes (usually \"./dist\"). This is what gets published for packages.",
      "<strong>declaration</strong> ‚Äî Set to true to generate .d.ts type declaration files alongside your JavaScript. Essential for packages ‚Äî without this, consumers get no type information."
    ],
    gotcha: "‚ö†Ô∏è A common mistake is copying a tsconfig from a web app into a package project. App configs are optimized for bundlers (which handle module resolution themselves), while package configs need to produce standalone JavaScript that Node.js or other bundlers can consume directly. If your package works in your project but breaks when someone installs it, check your module and moduleResolution settings first.",
    explainerTitle: "tsconfig.json ‚Äî a backend analogy",
    explainerBody: "tsconfig.json is like your compiler settings in a statically typed backend language. The 'target' option is similar to choosing a Java version in build.gradle ‚Äî it determines which language features are available in your output. 'strict' mode is like enabling all compiler warnings and treating them as errors ‚Äî more annoying during development, but it catches real bugs before they reach production. The 'paths' option works like import aliases in Python or module resolution rules in Webpack ‚Äî it lets you write clean imports like '@myapp/utils' instead of '../../../utils'. For packages, the 'declaration' option is critical: it generates the TypeScript equivalent of header files (.h in C) or interface definitions, telling consumers exactly what types your functions accept and return.<br><br>üìé <strong>Related:</strong> tsconfig controls <em>how</em> TypeScript compiles your code, but your build tool (Vite, tsup, Rollup) controls <em>what</em> happens to the output ‚Äî bundling, minification, and output formats. See the <button class='inline-nav-link' data-nav='build'>‚öôÔ∏è Build & Output</button> section for more.",
    links: [
      { label: "TSConfig Reference", url: "https://www.typescriptlang.org/tsconfig", source: "TypeScript" },
      { label: "What is a tsconfig.json?", url: "https://www.typescriptlang.org/docs/handbook/tsconfig-json.html", source: "TypeScript" },
      { label: "Recommended TSConfig bases", url: "https://github.com/tsconfig/bases", source: "GitHub" },
      { label: "Module resolution ‚Äî Node16 vs Bundler", url: "https://www.typescriptlang.org/docs/handbook/modules/theory.html", source: "TypeScript" }
    ]
  },
  {
    id: "build",
    title: "‚öôÔ∏è Build & Output",
    webapp: [
      "You use a 'bundler' to combine all your code into optimized files the browser can run. The two most common ones are Vite" + fnRef(1) + " (fast, modern, recommended for new projects) and Webpack" + fnRef(3) + " (older, very configurable, still widely used).",
      "The output is HTML, CSS, and JavaScript files deployed to a web server or CDN ‚Äî similar to deploying a backend to a cloud provider.",
      "You only need to target browsers, so one output format is fine. Vite and Webpack handle all the optimization for you."
    ],
    pkg: [
      "You need to output your code in multiple formats because you don't know what system will consume it.",
      "ESM" + fnRef(5) + " (ES Modules) = modern 'import/export' syntax. CJS (CommonJS) = older 'require()' syntax used by Node.js.",
      "Common choices for packages: tsup" + fnRef(4) + " (easiest to start with), Rollup" + fnRef(6) + ", or unbuild. Vite" + fnRef(2) + " and Webpack can also be configured for library output, though tsup and Rollup are purpose-built for it and require less setup."
    ],
    gotcha: "‚ö†Ô∏è ESM vs CJS is like Python 2 vs 3 ‚Äî two module systems that don't always play nice together. Always ship ESM at minimum. tsup can output both formats with one config.<br><br>üê≥ <strong>Docker note:</strong> Docker is primarily relevant to web apps, not npm packages. Apps are often containerized for deployment (Docker image ‚Üí push to registry ‚Üí deploy to cloud). Packages don't need Docker ‚Äî they're published to npm, not deployed as running services. If you're coming from backend development where everything runs in Docker, know that in the JS ecosystem, Docker is for apps (and sometimes for CI environments), not for libraries.",
    explainerTitle: "What's a bundler?",
    explainerBody: "A bundler takes all your source files (JS, TS, CSS, images) and combines them into optimized output files. It's like a compiler for the frontend world ‚Äî it resolves imports, removes dead code, and produces files ready for production. Vite is the current favorite for apps because it's extremely fast during development (using native ES modules) and produces optimized builds for production. Webpack is older but has a massive ecosystem of plugins. Both can be configured for library output too ‚Äî Vite even has a dedicated 'library mode' ‚Äî but tools like tsup and Rollup tend to require less config for that use case.<br><br>üìé <strong>Related:</strong> Your build tool works hand-in-hand with your <button class='inline-nav-link' data-nav='tsconfig'>‚öôÔ∏è tsconfig.json</button> ‚Äî the TypeScript compiler configuration. To verify your build runs successfully in CI, see the <button class='inline-nav-link' data-nav='ci-build'>üî® Build Verification</button> section.",
    links: [
      { label: "Vite ‚Äî Getting Started", url: "https://vite.dev/guide/", source: "Vite" },
      { label: "Vite ‚Äî Library Mode", url: "https://vite.dev/guide/build.html#library-mode", source: "Vite" },
      { label: "Webpack ‚Äî Getting Started", url: "https://webpack.js.org/guides/getting-started/", source: "Webpack" },
      { label: "tsup ‚Äî Bundle TypeScript libraries", url: "https://tsup.egoist.dev/", source: "tsup" },
      { label: "ES Modules: import/export", url: "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import", source: "MDN" },
      { label: "Rollup ‚Äî Module bundler for libraries", url: "https://rollupjs.org/introduction/", source: "Rollup" }
    ]
  },
  {
    id: "dist",
    title: "üìÅ Folder Structure",
    group: "concepts",
    intro: "JavaScript projects follow a common folder convention you'll see almost everywhere:<ul><li><strong>src/</strong> ‚Äî your source code: TypeScript, JSX, styles, and everything you write</li><li><strong>dist/</strong> (or <strong>build/</strong>, <strong>out/</strong>) ‚Äî compiled output generated by your build tool</li><li><strong>node_modules/</strong> ‚Äî installed dependencies (never commit this to Git)</li><li><strong>test/</strong> or <strong>__tests__/</strong> ‚Äî test files</li><li><strong>.github/</strong> ‚Äî CI workflows and GitHub configuration</li><li><strong>package.json</strong>, <strong>tsconfig.json</strong>, <strong>.eslintrc</strong> ‚Äî config files at the project root</li></ul>The distinction between <strong>src/</strong> and <strong>dist/</strong> becomes especially important when building npm packages ‚Äî understanding what goes where is key to publishing correctly. See the Web App vs NPM Package sections for more on this.",
    customColumns: true,
    col1Label: "üìù src/ (source)",
    col1Class: "col--webapp",
    col1: [
      "src/ is where you write your code: TypeScript, JSX, SCSS, config files, tests ‚Äî everything that makes up the development version of your project.",
      "This is YOUR workspace. It may contain syntax that browsers or Node.js can't run directly (like TypeScript or JSX), so it needs to be compiled before it can be used.",
      "Think of it like .java or .go source files ‚Äî they need a compilation step before they're usable. src/ should never be published to npm."
    ],
    col2Label: "üì¶ dist/ (distributable)",
    col2Class: "col--pkg",
    col2: [
      "dist/ (short for 'distributable') contains the compiled, ready-to-use output of your package. This is what consumers actually run when they install your package.",
      "It's generated by your build tool (tsup, Rollup, Vite, etc.) and typically contains: compiled .js files (ESM and/or CJS), type declarations (.d.ts), and sometimes CSS.",
      "You publish ONLY dist/ to npm. It's the finished product ‚Äî like shipping a compiled .jar instead of raw .java files, or a REST API instead of database schemas."
    ],
    gotcha: "‚ö†Ô∏è When publishing a package, only dist/ should go to npm ‚Äî everything else (src/, tests, configs, node_modules) is part of your development workflow, not what consumers receive. If you accidentally publish src/, you're shipping uncompiled TypeScript that consumers can't use directly, plus bloating their node_modules with files they don't need. Always use the 'files' field" + fnRef(1) + " in package.json to whitelist only dist/. Use " + cmd("npm pack --dry-run", "pnpm pack --dry-run") + fnRef(2) + " to preview exactly what will be included.",
    explainerTitle: "Why not just ship the source code?",
    explainerBody: "Three reasons. First, consumers might not have your build tools ‚Äî if your src/ uses TypeScript but they use plain JavaScript, they can't compile your code. Second, the compiled output is optimized: dead code is removed, modules are resolved, and the code is ready to run. Third, shipping src/ exposes internals you don't want people depending on ‚Äî it's like giving someone access to your database schema when they only need a REST API. The dist/ folder is your package's public interface: clean, compiled, and intentional. As a fallback, you can also use .npmignore" + fnRef(3) + " to exclude files, though the 'files' whitelist approach is preferred.",
    links: [
      { label: '"files" field ‚Äî control what you publish', url: "https://docs.npmjs.com/cli/v10/configuring-npm/package-json#files", source: "npm" },
      { label: "npm pack ‚Äî preview published contents", url: "https://docs.npmjs.com/cli/v10/commands/npm-pack", source: "npm" },
      { label: ".npmignore docs", url: "https://docs.npmjs.com/cli/v10/using-npm/developers#keeping-files-out-of-your-package", source: "npm" }
    ]
  },
  {
    id: "deps",
    title: "üì¶ Dependencies",
    webapp: [
      "Install whatever packages you need ‚Äî they all get bundled into your final app.",
      "The distinction between 'dependencies' and 'devDependencies' in package.json is mostly organizational. Everything gets bundled anyway.",
      "Bundle size matters for performance, but it's your call how to balance that."
    ],
    pkg: [
      "Every dependency you add becomes a dependency for EVERYONE who installs your package. Keep them minimal.",
      "There are 3 types that matter: 'dependencies'" + fnRef(1) + " (shipped with your package), 'devDependencies' (only for building/testing), and 'peerDependencies'" + fnRef(2) + " (the consumer must provide these).",
      "peerDependencies are crucial: if your package uses React, list React as a peerDependency so consumers use THEIR copy, not a second one."
    ],
    gotcha: "‚ö†Ô∏è Classic mistake: putting React in 'dependencies' instead of 'peerDependencies'. This installs a SECOND copy of React in the consumer's project, causing mysterious crashes. It's like having two different versions of a database driver loaded at once.",
    explainerTitle: "What's peerDependencies?",
    explainerBody: "Imagine you write a plugin for Express.js. You don't want to bundle your own copy of Express ‚Äî you want to use whatever version the developer already has. That's what peerDependencies does. You're saying: 'I need this to work, but YOU provide it.' For frontend packages, React is the most common peerDependency.",
    links: [
      { label: "package.json dependencies", url: "https://docs.npmjs.com/cli/v10/configuring-npm/package-json#dependencies", source: "npm" },
      { label: "peerDependencies explained", url: "https://docs.npmjs.com/cli/v10/configuring-npm/package-json#peerdependencies", source: "npm" },
      { label: "npm install docs", url: "https://docs.npmjs.com/cli/v10/commands/npm-install", source: "npm" },
      { label: "pnpm install docs", url: "https://pnpm.io/cli/install", source: "pnpm" }
    ]
  },
  {
    id: "typescript",
    title: "üî∑ TypeScript & Types",
    intro: "TypeScript is a superset of JavaScript that adds static type annotations ‚Äî like adding type hints to Python, or going from a dynamic language to a compiled one. You write code with types (function greet(name: string): string), and the TypeScript compiler checks for mistakes before your code ever runs. It catches bugs like calling a function with the wrong argument type, accessing a property that doesn't exist, or returning the wrong type. Almost all modern JavaScript projects use TypeScript, and npm packages are expected to ship type information.",
    webapp: [
      "Your types only matter to your own team. Nobody outside your project sees them.",
      "Your tsconfig.json" + fnRef(3) + " (TypeScript config) is tuned for your specific app and bundler.",
      "Type errors are caught during development ‚Äî they don't affect your deployed app since TypeScript compiles away to plain JavaScript."
    ],
    pkg: [
      "You MUST ship type declaration files" + fnRef(1) + " (.d.ts) alongside your JavaScript. These tell consumers what types your functions accept and return.",
      "Your types ARE your public API contract. If a function signature changes, that's a breaking change. See the publishing guide" + fnRef(2) + " for how to ship them correctly.",
      "Tools like tsup auto-generate .d.ts files from your TypeScript source. Without them, consumers get no autocomplete or type checking."
    ],
    gotcha: "‚ö†Ô∏è Forgetting to ship .d.ts files is the #1 complaint about npm packages. It's like publishing a REST API with no documentation ‚Äî technically usable, but painful.",
    explainerTitle: "What are .d.ts files?",
    explainerBody: "Declaration files (.d.ts) are like header files in C or interface definitions in Java/Go. They describe the shape of your code ‚Äî function signatures, types, exported classes ‚Äî without the actual implementation. They let TypeScript users get autocomplete, type checking, and inline docs when using your package.",
    links: [
      { label: "TypeScript declaration files", url: "https://www.typescriptlang.org/docs/handbook/declaration-files/introduction.html", source: "TypeScript" },
      { label: "Publishing types with your package", url: "https://www.typescriptlang.org/docs/handbook/declaration-files/publishing.html", source: "TypeScript" },
      { label: "tsconfig.json reference", url: "https://www.typescriptlang.org/tsconfig/", source: "TypeScript" }
    ]
  },
  {
    id: "packagejson",
    title: "üìã package.json",
    webapp: [
      "package.json mainly tracks your dependencies and scripts (like '" + cmd("npm run dev", "pnpm dev") + "' or '" + cmd("npm run build", "pnpm build") + "').",
      "Fields like 'main' and 'exports' don't really matter because your entry point is an HTML file.",
      "It's similar to a requirements.txt + Makefile combined into one file."
    ],
    pkg: [
      "package.json" + fnRef(1) + " is your package's configuration AND public API definition. It tells npm and bundlers where to find your code.",
      "The 'exports'" + fnRef(2) + " field maps import paths to actual files ‚Äî it controls what consumers can import.",
      "The 'files'" + fnRef(3) + " field controls what gets uploaded to npm. Only include your 'dist' folder ‚Äî don't publish source code, tests, or configs."
    ],
    explainerTitle: "Why 'exports' instead of just 'main'?",
    explainerBody: "The 'main' field is the old way ‚Äî it points to a single entry file. The 'exports' field is the modern replacement. It lets you define different entry points for different contexts (ESM vs CJS, types vs runtime) and create subpath imports. Think of it like routing in a web framework ‚Äî mapping import paths to actual files. See the Node.js Packages docs" + fnRef(4) + " for the full specification.",
    code: true,
    links: [
      { label: "package.json full reference", url: "https://docs.npmjs.com/cli/v10/configuring-npm/package-json", source: "npm" },
      { label: "Node.js package exports", url: "https://nodejs.org/api/packages.html#package-entry-points", source: "Node.js" },
      { label: '"files" field', url: "https://docs.npmjs.com/cli/v10/configuring-npm/package-json#files", source: "npm" },
      { label: "Modules: Packages", url: "https://nodejs.org/api/packages.html", source: "Node.js" }
    ]
  },
  {
    id: "versioning",
    title: "üè∑Ô∏è Versioning",
    webapp: [
      "You deploy continuously ‚Äî users always get the latest version automatically.",
      "If you ship a bug, you can hotfix and redeploy in minutes.",
      "Version numbers exist but are mostly internal ‚Äî users never see them."
    ],
    pkg: [
      "You follow 'semver'" + fnRef(1) + " (semantic versioning): MAJOR.MINOR.PATCH ‚Äî e.g., 2.1.3.",
      "Published versions are essentially permanent. Consumers pin versions, so a bug might live in their project for months.",
      "In a CI pipeline, tools like changesets" + fnRef(3) + " or semantic-release" + fnRef(4) + " can automate version bumps. They analyze your commit messages (e.g., 'feat:' ‚Üí minor, 'fix:' ‚Üí patch, 'BREAKING CHANGE:' ‚Üí major), generate changelogs, and publish to npm ‚Äî all triggered by merging a PR."
    ],
    gotcha: "‚ö†Ô∏è Semver trust is everything. MAJOR = breaking changes, MINOR = new features, PATCH = bug fixes. If you accidentally break something in a minor release, developers lose trust fast ‚Äî it's like changing a REST API response shape without bumping the API version. CI automation helps prevent human error here. Use the npm semver calculator" + fnRef(2) + " to understand version ranges.",
    explainerTitle: "What's semver and how does CI help?",
    explainerBody: "Semantic Versioning (semver) is a contract with your users. Given version MAJOR.MINOR.PATCH: bump MAJOR when you make incompatible API changes (like renaming a function), bump MINOR when you add functionality in a backward-compatible way, and bump PATCH for backward-compatible bug fixes. When someone installs '^2.1.0', they trust that any 2.x.x update won't break their code. In practice, most teams automate this with CI. A tool like 'changesets' lets developers declare version intent in their PRs, then a CI pipeline (GitHub Actions, etc.) handles the actual version bump, changelog generation, and npm publish when PRs are merged. 'semantic-release' takes a different approach ‚Äî it reads Conventional Commit" + fnRef(5) + " messages to determine the version automatically. Either way, CI removes the human error of forgetting to bump or mis-categorizing a change.",
    links: [
      { label: "Semantic Versioning spec", url: "https://semver.org/", source: "semver" },
      { label: "npm semver calculator", url: "https://semver.npmjs.com/", source: "npm" },
      { label: "changesets ‚Äî version management for monorepos", url: "https://github.com/changesets/changesets", source: "GitHub" },
      { label: "semantic-release ‚Äî automated versioning", url: "https://semantic-release.gitbook.io/semantic-release", source: "Docs" },
      { label: "Conventional Commits spec", url: "https://www.conventionalcommits.org/", source: "Docs" }
    ]
  },
  {
    id: "workflow",
    title: "üîÑ Dev Workflow",
    webapp: [
      "Write code ‚Üí see changes instantly in the browser (hot reload)",
      "Test locally ‚Üí push to Git ‚Üí CI/CD deploys to production",
      "Users see changes immediately after deploy"
    ],
    pkg: [
      "Write code ‚Üí test locally with " + cmd("npm link", "pnpm link") + fnRef(1) + fnRef(2) + " (symlinks your package into a test project)",
      "Build ‚Üí test ‚Üí bump version ‚Üí run " + cmd("npm publish", "pnpm publish") + fnRef(6) + " to push to the npm registry",
      "Consumers update when they choose to: " + cmd("npm update", "pnpm update") + " or changing their package.json. See the full publishing guide" + fnRef(5) + " for the complete workflow."
    ],
    gotcha: "‚ö†Ô∏è Always run " + cmd("npm pack --dry-run", "pnpm pack --dry-run") + fnRef(3) + fnRef(4) + " before publishing! This shows you exactly what files will be included. It's like doing a dry-run deployment ‚Äî catch mistakes before they're live.",
    explainerTitle: "What's " + cmd("npm link", "pnpm link") + "?",
    explainerBody: cmd("npm link", "pnpm link") + " creates a symbolic link from a test project to your local package source. Instead of publishing every time you make a change, you can test your package locally in a real project. It's like mounting a local directory as a volume in Docker ‚Äî the test project uses your live source code.",
    links: [
      { label: "npm link docs", url: "https://docs.npmjs.com/cli/v10/commands/npm-link", source: "npm" },
      { label: "pnpm link docs", url: "https://pnpm.io/cli/link", source: "pnpm" },
      { label: "npm pack docs", url: "https://docs.npmjs.com/cli/v10/commands/npm-pack", source: "npm" },
      { label: "pnpm pack docs", url: "https://pnpm.io/cli/pack", source: "pnpm" },
      { label: "Creating and publishing a package", url: "https://docs.npmjs.com/creating-and-publishing-unscoped-public-packages", source: "npm" },
      { label: "pnpm publish docs", url: "https://pnpm.io/cli/publish", source: "pnpm" }
    ]
  }
];

// CI Pipeline & Checks ‚Äî split into sub-pages
const ciOverviewIntro = "A CI (Continuous Integration) pipeline runs automated checks every time you push code or open a pull request. In the JavaScript ecosystem, GitHub Actions" + fnRef(1) + " is the most common CI tool ‚Äî it runs your checks in the cloud so bugs, broken builds, and style issues are caught before code is merged. Think of it like a gatekeeper that runs your test suite, linting, and build process automatically, just like you might have Jenkins or GitLab CI running tests for a backend project.<br><br>For <strong>web apps</strong>, you test user-facing behavior: does the button work? Does the page load correctly? For <strong>npm packages</strong>, you test your public API: do exported functions return correct values? Do edge cases work? Package tests should import from your built output (or at least your public exports), not internal files ‚Äî this catches issues consumers would actually hit.";

const ciPages = [
  {
    id: "ci-overview",
    title: "üîÑ CI Overview",
    intro: ciOverviewIntro,
    isOverview: true,
    explainerTitle: "CI pipelines ‚Äî a backend analogy",
    explainerBody: "If you've used Jenkins, GitLab CI, or CircleCI for backend projects, GitHub Actions works the same way ‚Äî YAML config, runs on push/PR, runs in containers. The main difference in JS land is that 'build' is a required step (TypeScript needs compilation), and linting is more critical because JavaScript is dynamically typed ‚Äî the linter catches what a compiler would catch in Go or Java. The pipeline order (lint ‚Üí build ‚Üí unit tests ‚Üí E2E) mirrors what you'd do in a backend CI: static analysis first, then compilation, then fast tests, then slow integration tests.",
    exampleWorkflow: `<span class="comment"># .github/workflows/ci.yml</span>
<span class="key">name</span>: CI
<span class="key">on</span>: [push, pull_request]

<span class="key">jobs</span>:
  <span class="key">check</span>:
    <span class="key">runs-on</span>: ubuntu-latest
    <span class="key">steps</span>:
      - <span class="key">uses</span>: actions/checkout@v4
      - <span class="key">uses</span>: actions/setup-node@v4
        <span class="key">with</span>:
          <span class="key">node-version</span>: <span class="string">20</span>

      - <span class="key">name</span>: Install
        <span class="key">run</span>: <span class="string">${cmd("npm ci", "pnpm install --frozen-lockfile")}</span>

      - <span class="key">name</span>: Lint
        <span class="key">run</span>: <span class="string">${cmd("npx eslint . --max-warnings 0", "pnpm eslint . --max-warnings 0")}</span>

      - <span class="key">name</span>: Build
        <span class="key">run</span>: <span class="string">${cmd("npm run build", "pnpm build")}</span>

      - <span class="key">name</span>: Unit Tests
        <span class="key">run</span>: <span class="string">${cmd("npm test", "pnpm test")}</span>

      - <span class="key">name</span>: E2E Tests
        <span class="key">run</span>: <span class="string">${cmd("npx playwright test", "pnpm playwright test")}</span>`,
    links: [
      { label: "GitHub Actions ‚Äî Quickstart", url: "https://docs.github.com/en/actions/quickstart", source: "GitHub" }
    ]
  },
  {
    id: "ci-linting",
    title: "üßπ Linting & Formatting",
    intro: "A <strong>linter</strong> (ESLint" + fnRef(1) + ") and a <strong>formatter</strong> (Prettier" + fnRef(2) + ") serve different purposes, and understanding the difference matters." +
      "<h4 class='section-subheading' id='toc-linting'>Linting (ESLint)</h4>" +
      "ESLint statically analyzes your code for bugs, bad patterns, and code quality issues like unused variables, missing return types, or potential runtime errors. It doesn't run your code ‚Äî it reads it and flags problems." +
      "<h4 class='section-subheading' id='toc-formatting'>Formatting (Prettier)</h4>" +
      "Prettier is a formatter ‚Äî it only cares about how code <em>looks</em>: indentation, line length, quote style, trailing commas. It doesn't catch bugs." +
      "<h4 class='section-subheading' id='toc-eslint-stylistic'>eslint-stylistic ‚Äî an alternative</h4>" +
      "Historically, most projects used both tools together (ESLint for logic, Prettier for style). But there's a newer alternative: <strong>eslint-stylistic</strong>" + fnRef(3) + " ‚Äî an ESLint plugin that handles formatting rules directly inside ESLint, so you can drop Prettier entirely and run a single tool for both code quality and style. This simplifies your toolchain and avoids the occasional ESLint-vs-Prettier config conflicts." + fnRef(4) +
      "<h4 class='section-subheading' id='toc-ide'>IDE Integration</h4>" +
      "Most editors (VS Code, WebStorm, Cursor) can hook into your linter and formatter to show errors inline and auto-fix on save. This means formatting and many lint fixes happen automatically as you type ‚Äî you almost never need to think about style manually. Set up \"format on save\" and ESLint auto-fix in your editor and your code stays clean without any effort.",
    yaml: "- name: Lint\n  run: " + cmd("npx eslint . --max-warnings 0", "pnpm eslint . --max-warnings 0"),
    tip: "Use --max-warnings 0 to fail the build on any warning. This keeps your codebase clean over time instead of slowly accumulating 'harmless' warnings that hide real issues. Your CI should always run the same lint check that your IDE runs locally ‚Äî no surprises.",
    links: [
      { label: "ESLint ‚Äî Getting Started", url: "https://eslint.org/docs/latest/use/getting-started", source: "ESLint", note: "Official setup guide for ESLint" },
      { label: "Prettier ‚Äî Install", url: "https://prettier.io/docs/en/install", source: "Prettier", note: "The traditional code formatter for JS/TS projects" },
      { label: "eslint-stylistic ‚Äî Formatting with ESLint", url: "https://eslint.style/", source: "eslint-stylistic", note: "Drop-in replacement for Prettier using ESLint rules" },
      { label: "Why I don't use Prettier (Anthony Fu)", url: "https://antfu.me/posts/why-not-prettier", source: "Blog", note: "Case for eslint-stylistic over Prettier from a core Vite maintainer" }
    ]
  },
  {
    id: "ci-build",
    title: "üî® Build Verification",
    intro: "This step compiles your TypeScript and bundles your package to verify the build succeeds. A passing build means your code is syntactically valid, all imports resolve, and the output files (JS + .d.ts types) are generated correctly. For packages, this is critical ‚Äî if the build breaks, you'd publish a broken package to npm.<br><br><button class='inline-nav-pill' data-nav='build'>üìé See also: ‚öôÔ∏è Build & Output ‚Äî bundlers, ESM vs CJS, and build tools</button>",
    yaml: "- name: Build\n  run: " + cmd("npm run build", "pnpm build"),
    tip: "Run the build AFTER linting ‚Äî there's no point compiling code that has lint errors. This ordering catches issues faster and saves CI minutes.",
    links: []
  },
  {
    id: "ci-testing",
    title: "üß™ Testing",
    intro: "Testing in the JS ecosystem falls into several categories, and understanding when to use each is key to a good test suite.",
    isTestingPage: true,
    unitSection: {
      heading: "üß™ Unit Tests",
      text: "Unit tests verify that individual functions, components, or modules work correctly <strong>in isolation</strong>. They're fast (milliseconds each), don't need a browser or server, and give you confidence that refactoring hasn't broken existing behavior. Common tools: <strong>Vitest</strong>" + fnRef(1) + " (fast, modern, recommended) and <strong>Jest</strong> (older but widespread). Think of them like pytest or JUnit tests ‚Äî testing small units of logic.",
      yaml: "- name: Unit Tests\n  run: " + cmd("npm test", "pnpm test"),
      tip: "For packages, test your PUBLIC API ‚Äî the functions consumers actually import. Internal implementation details can change freely as long as the public interface works correctly."
    },
    e2eSection: {
      heading: "üåê End-to-End (E2E) Tests",
      text: "E2E tests verify that your code works <strong>in a real environment</strong> ‚Äî an actual browser for web apps, or a real Node.js project for packages. They're slower but catch integration issues that unit tests miss: CSS rendering bugs, browser compatibility, import resolution in consumer projects. Common tools: <strong>Playwright</strong>" + fnRef(2) + " (recommended) and <strong>Cypress</strong>. For packages, E2E often means installing your built package in a test project and verifying imports, types, and functionality work end-to-end.",
      yaml: "- name: E2E Tests\n  run: " + cmd("npx playwright test", "pnpm playwright test"),
      tip: "Run E2E tests last in your CI pipeline ‚Äî they're the slowest. If linting, build, or unit tests fail, there's no point running expensive browser tests."
    },
    storybookNote: "üìñ <strong>Storybook component tests</strong> are a third option worth considering. Storybook can run your stories as tests ‚Äî each story becomes a test case that verifies a component renders correctly with specific props. This sits between unit tests and E2E tests: it renders real components (like E2E) but runs fast and in isolation (like unit tests). You might choose <strong>unit tests</strong> when testing pure logic, utility functions, hooks, or non-visual behavior. Choose <strong>component tests</strong> (via Storybook) when testing visual rendering, prop variations, interaction flows, and accessibility ‚Äî especially if you're already writing stories for documentation. The two approaches complement each other: unit tests for logic, component tests for UI. See the <button class='inline-nav-link' data-nav='storybook'>üìñ Storybook</button> section for more.",
    coverageText: "<strong>Test coverage</strong>" + fnRef(5) + " measures what percentage of your code is executed by your tests. A coverage report shows which lines, branches, and functions have been tested. High coverage (80%+) gives confidence that most code paths are exercised. But don't blindly chase 100% ‚Äî some code (error handlers, edge cases in generated code, simple pass-through functions) isn't worth testing. Focus coverage on your public API, complex business logic, and code paths where bugs would be most damaging. Vitest and Jest both have built-in coverage reporting via <code>--coverage</code>.",
    goodTests: [
      "<strong>Independent</strong> ‚Äî no shared state between tests. Each test should set up its own data and clean up after itself.",
      "<strong>Deterministic</strong> ‚Äî same result every time. Avoid dependencies on dates, random values, or network calls without mocking.",
      "<strong>Fast</strong> ‚Äî especially unit tests. If your test suite takes minutes, developers stop running it.",
      "<strong>Readable</strong>" + fnRef(3) + " ‚Äî someone new should understand what's being tested. Name tests clearly: <code>it('returns empty array when no items match filter')</code> is better than <code>it('test filter')</code>.",
      "<strong>Behavior-focused</strong>" + fnRef(4) + " ‚Äî test what the code does, not how it does it. If you refactor internals, your tests should still pass."
    ],
    aiPrompts: [
      { label: "Unit test prompt for a utility function", prompt: "Write unit tests for this function using Vitest. Cover: normal inputs, edge cases (empty arrays, null values, boundary numbers), and error cases. Each test should have a descriptive name explaining the expected behavior. Use describe/it blocks for organization." },
      { label: "Unit test prompt for a React component", prompt: "Write unit tests for this React component using Vitest and React Testing Library. Test: rendering with default props, rendering with each prop variation, user interactions (clicks, input changes), conditional rendering, and accessibility (correct ARIA roles). Mock any API calls or context providers." },
      { label: "E2E test prompt for a web page", prompt: "Write Playwright E2E tests for this page. Test: page loads without errors, key elements are visible, user can complete the main workflow (fill form ‚Üí submit ‚Üí see success), error states are handled gracefully, and the page works at mobile viewport widths." },
      { label: "E2E test prompt for an npm package", prompt: "Write an E2E test that installs this package in a fresh project and verifies: the package installs without errors, named exports can be imported, TypeScript types resolve correctly (tsc --noEmit passes), the main function returns expected output, and tree-shaking works (unused exports aren't in the bundle)." }
    ],
    links: [
      { label: "Vitest ‚Äî Getting Started", url: "https://vitest.dev/guide/", source: "Vitest", note: "The recommended modern test runner for TypeScript projects" },
      { label: "Playwright ‚Äî Getting Started", url: "https://playwright.dev/docs/intro", source: "Playwright", note: "Cross-browser E2E testing framework from Microsoft" },
      { label: "Testing Library ‚Äî Guiding Principles", url: "https://testing-library.com/docs/guiding-principles", source: "Testing Library", note: "Philosophy behind testing user-facing behavior, not implementation" },
      { label: "Kent C. Dodds ‚Äî Write tests. Not too many.", url: "https://kentcdodds.com/blog/write-tests", source: "Blog", note: "Influential essay on testing strategy and the testing trophy" },
      { label: "Vitest ‚Äî Coverage", url: "https://vitest.dev/guide/coverage", source: "Vitest", note: "Built-in coverage reporting with v8 or Istanbul providers" }
    ]
  },
  {
    id: "ci-repo-maintenance",
    title: "üßπ Repo Maintenance",
    intro: "As projects grow, dependencies drift, unused code accumulates, and package.json files get out of sync ‚Äî especially in monorepos. These repo maintenance tools catch problems that linting and testing miss. They're not required for small projects, but become essential as codebases scale.",
    isMaintenancePage: true,
    tools: [
      {
        name: "knip",
        emoji: "‚úÇÔ∏è",
        desc: "Knip" + fnRef(1) + " finds <strong>unused files, dependencies, and exports</strong> in your project. It scans your codebase and tells you which packages in your package.json aren't actually imported anywhere, which exported functions are never used, and which entire files are dead code. Think of it like a tree-shaker for your repo ‚Äî it identifies what can be safely removed.",
        why: "Unused dependencies slow down installs, bloat your bundle, and create security surface area. Unused exports in packages confuse consumers and increase maintenance burden. Knip catches all of this automatically.",
        yaml: "- name: Check unused code\n  run: " + cmd("npx knip", "pnpm knip"),
      },
      {
        name: "syncpack",
        emoji: "üîó",
        desc: "Syncpack" + fnRef(2) + " ensures <strong>consistent dependency versions</strong> across all packages in a monorepo. If one package uses React 18.2.0 and another uses React 18.3.0, syncpack flags the mismatch. It can also enforce version ranges, banned dependencies, and consistent formatting of package.json files.",
        why: "Version mismatches in monorepos cause subtle bugs: one package tests against a different version than another, leading to 'works on my machine' problems. Syncpack catches these before they hit production.",
        yaml: "- name: Check dependency versions\n  run: " + cmd("npx syncpack lint", "pnpm syncpack lint"),
      }
    ],
    tip: "Add both tools to your CI pipeline as a separate step. They're fast (seconds, not minutes) and catch issues that are tedious to find manually. For monorepos, these tools are practically essential.",
    links: [
      { label: "knip ‚Äî Find unused files, dependencies and exports", url: "https://knip.dev/", source: "knip" },
      { label: "syncpack ‚Äî Consistent dependency versions", url: "https://jamiemason.github.io/syncpack/", source: "syncpack" }
    ]
  }
];

const ciPageIds = ciPages.map(p => p.id);

// Bonus sections
const bonusSections = [
  {
    id: "storybook",
    title: "üìñ Storybook",
    intro: "Storybook" + fnRef(1) + " is a tool for building and testing UI components in isolation ‚Äî outside of your app. It creates a standalone workshop where you can develop, document, and visually test every component in every state, without needing to navigate through your actual application to reach that component. Think of it like a visual unit test lab for your UI.",
    content: [
      {
        heading: "What is it?",
        text: "Storybook runs a local dev server that renders your components independently. You write 'stories'" + fnRef(4) + " ‚Äî small files that describe how to render a component with specific props. Each story is one state of a component: a button in its default state, a loading state, a disabled state, an error state. Storybook then shows all these states side-by-side in a browsable catalog."
      },
      {
        heading: "Why is it important?",
        text: "Without Storybook" + fnRef(2) + ", testing a component in a specific state means navigating through your app, logging in, clicking through menus, and manually triggering that state ‚Äî every single time. Storybook lets you jump directly to any component in any state instantly. This is especially valuable for edge cases (empty states, error states, long text overflow) that are hard to reproduce in a running app but easy to create as a story."
      },
      {
        heading: "How it helps development",
        text: "Storybook improves your workflow in several ways: it <strong>catches visual bugs</strong> by rendering every component state so you can spot issues before they reach production. It serves as <strong>living documentation</strong> ‚Äî designers, PMs, and new developers can browse all your components without running the app. It enables <strong>visual regression testing</strong> with tools like Chromatic" + fnRef(3) + " that screenshot every story and diff against the last version. And for <strong>npm packages</strong>, Storybook is practically essential ‚Äî it's how you develop, test, and showcase your component library to consumers."
      }
    ],
    explainerTitle: "Storybook ‚Äî a backend analogy",
    explainerBody: "If you've used Swagger/OpenAPI to document and test REST API endpoints independently, Storybook is the UI equivalent. Instead of testing endpoints with different request bodies, you're testing components with different props. Instead of a Swagger UI that lists all your routes, Storybook lists all your components. Both let you interact with individual pieces of your system without booting up the entire application. For package authors, Storybook is even more important ‚Äî it's like having interactive API documentation that consumers can play with before installing your package.",
    links: [
      { label: "Storybook ‚Äî Getting Started", url: "https://storybook.js.org/docs/get-started", source: "Storybook" },
      { label: "Storybook ‚Äî Why Storybook?", url: "https://storybook.js.org/docs/get-started/why-storybook", source: "Storybook" },
      { label: "Chromatic ‚Äî Visual testing for Storybook", url: "https://www.chromatic.com/", source: "Chromatic" },
      { label: "Storybook ‚Äî Writing Stories", url: "https://storybook.js.org/docs/writing-stories", source: "Storybook" }
    ]
  }
];

const bonusIds = bonusSections.map(s => s.id);

const checklistItems = [
  { text: "Ships ESM format (and optionally CJS for older Node.js)", cat: "Build", badge: "badge-build" },
  { text: "Includes TypeScript declarations (.d.ts files)", cat: "Types", badge: "badge-types" },
  { text: 'package.json "exports" field properly configured', cat: "Config", badge: "badge-config" },
  { text: '"files" field limits published content to dist/ only', cat: "Config", badge: "badge-config" },
  { text: "Framework deps (React, etc.) are peerDependencies, not dependencies", cat: "Deps", badge: "badge-deps" },
  { text: "README with: install command, basic usage example, API reference", cat: "Docs", badge: "badge-docs" },
  { text: "CHANGELOG tracks what changed in each version", cat: "Docs", badge: "badge-docs" },
  { text: "Ran " + cmd("npm pack --dry-run", "pnpm pack --dry-run") + " to verify published contents", cat: "Pre-publish", badge: "badge-prepublish" },
  { text: "All tests pass against the public API", cat: "Pre-publish", badge: "badge-prepublish" },
  { text: "LICENSE file included (MIT is most common for open source)", cat: "Legal", badge: "badge-legal" },
  { text: "Version bumped following semver rules", cat: "Pre-publish", badge: "badge-prepublish" },
  { text: ".npmignore or 'files' field excludes tests, source, and config files", cat: "Config", badge: "badge-config" }
];

const codeExample = `<span class="comment">// A well-configured package.json for an npm package</span>
{
  <span class="key">"name"</span>: <span class="string">"my-cool-package"</span>,

  <span class="comment">// "type": "module" means this package uses modern</span>
  <span class="comment">// import/export syntax by default</span>
  <span class="key">"type"</span>: <span class="string">"module"</span>,

  <span class="comment">// Fallback entry points for older tools</span>
  <span class="key">"main"</span>: <span class="string">"./dist/index.cjs"</span>,
  <span class="key">"module"</span>: <span class="string">"./dist/index.js"</span>,
  <span class="key">"types"</span>: <span class="string">"./dist/index.d.ts"</span>,

  <span class="comment">// Modern entry point config ‚Äî this is what</span>
  <span class="comment">// bundlers and Node.js actually read</span>
  <span class="key">"exports"</span>: {
    <span class="key">"."</span>: {
      <span class="key">"import"</span>: <span class="string">"./dist/index.js"</span>,
      <span class="key">"require"</span>: <span class="string">"./dist/index.cjs"</span>,
      <span class="key">"types"</span>: <span class="string">"./dist/index.d.ts"</span>
    },
    <span class="comment">// Subpath export ‚Äî consumers can do:</span>
    <span class="comment">// import { helper } from "my-cool-package/utils"</span>
    <span class="key">"./utils"</span>: {
      <span class="key">"import"</span>: <span class="string">"./dist/utils.js"</span>,
      <span class="key">"types"</span>: <span class="string">"./dist/utils.d.ts"</span>
    }
  },

  <span class="comment">// ONLY these files/folders get published to npm</span>
  <span class="key">"files"</span>: [<span class="string">"dist"</span>],

  <span class="comment">// Consumer must have React installed already</span>
  <span class="key">"peerDependencies"</span>: {
    <span class="key">"react"</span>: <span class="string">"^18.0.0 || ^19.0.0"</span>
  }
}`;

let activeSection = "roadmap";
const expandedExplainers = {};
const checkedItems = {};

const roadmapSteps = [
  {
    num: 1,
    title: "Decide: app or package?",
    desc: "Before writing any code, be clear about what you're building. An app is a complete product users interact with. A package is a tool other developers install.",
    detail: "This affects every decision that follows ‚Äî your build tool, how you handle dependencies, what you publish, and how you version releases.",
    jumpTo: "bigpicture"
  },
  {
    num: 2,
    title: "Choose your repo structure",
    desc: "Consider starting with a monorepo ‚Äî even for a single package. A monorepo structure encourages modularity and makes it easy to add more packages later without reorganizing everything.",
    detail: "A monorepo uses workspaces to host multiple packages in one Git repo, each with its own package.json. pnpm is the preferred package manager for monorepos ‚Äî its workspace support is faster and stricter than npm's. Tools like Turborepo or Nx layer on top to handle smart builds and caching. Even if you start with one package, the monorepo structure scales cleanly as the project grows.",
    jumpTo: "monorepo"
  },
  {
    num: 3,
    title: "Initialize your project",
    desc: "Run " + cmd("npm init", "pnpm init") + " to create your package.json. For a package, pay special attention to the <code>name</code>, <code>type</code>, and <code>description</code> fields right away.",
    detail: "Set <code>\"type\": \"module\"</code> for ESM. Choose a scoped name (<code>@yourorg/package-name</code>) to avoid naming collisions on npm. For an app, the defaults are usually fine.",
    jumpTo: null
  },
  {
    num: 4,
    title: "Set up your build tooling",
    desc: "For apps: use Vite or Webpack. For packages: use tsup, Rollup, or Vite in library mode. Configure your tool to output the formats you need.",
    detail: "Packages should output ESM at minimum (and optionally CJS). Apps just need browser-optimized bundles. Your build tool compiles src/ into dist/.",
    jumpTo: "build",
    substep: {
      text: "Configure your tsconfig.json ‚Äî the TypeScript compiler settings that control how your code gets compiled.",
      jumpTo: "tsconfig"
    }
  },
  {
    num: 5,
    title: "Write your source code in src/",
    desc: "Write TypeScript/JavaScript in your src/ directory. For packages, think carefully about your public API ‚Äî what functions and types will you export?",
    detail: "Your src/index.ts is the main entry point. For packages, only export what consumers need. Everything else stays internal. For apps, structure however your framework suggests.",
    jumpTo: null
  },
  {
    num: 6,
    title: "Configure your dependencies correctly",
    desc: "For packages: use <code>peerDependencies</code> for frameworks (React, Vue), minimize regular <code>dependencies</code>, and keep build tools in <code>devDependencies</code>.",
    detail: "Getting this wrong is one of the most common package mistakes. If your package uses React, it MUST be a peerDependency ‚Äî never a regular dependency.",
    jumpTo: "deps"
  },
  {
    num: 7,
    title: "Build ‚Üí verify dist/ output",
    desc: "Run your build command. Check that dist/ contains compiled .js files, .d.ts type declarations, and nothing else unnecessary.",
    detail: "The dist/ folder is what consumers actually use. Run " + cmd("npm pack --dry-run", "pnpm pack --dry-run") + " to preview exactly what will be published. If you see src/, tests, or config files ‚Äî fix your <code>files</code> field.",
    jumpTo: "dist"
  },
  {
    num: 8,
    title: "Configure package.json exports & files",
    desc: "For packages: set up the <code>exports</code> map to point to your dist/ files, and use the <code>files</code> field to whitelist only dist/.",
    detail: "The <code>exports</code> field is your package's public API surface. It maps import paths to compiled files and tells bundlers where to find ESM, CJS, and type declarations.",
    jumpTo: "packagejson"
  },
  {
    num: 9,
    title: "Set up TypeScript declarations",
    desc: "For packages: ensure your build generates .d.ts files and that package.json points to them via the <code>types</code> field.",
    detail: "Without .d.ts files, TypeScript users get no autocomplete or type safety. Tools like tsup do this automatically. Verify by checking that dist/ contains .d.ts files after building.",
    jumpTo: "typescript"
  },
  {
    num: 10,
    title: "Write tests against your public API",
    desc: "For apps: test user flows and UI behavior. For packages: test every exported function with normal inputs, edge cases, and error scenarios.",
    detail: "Package tests should import from your built output (or at least your public exports), not internal files. This catches issues consumers would actually hit.",
    jumpTo: "ci-overview"
  },
  {
    num: 11,
    title: "Set up versioning",
    desc: "For packages: choose a versioning strategy. Manual semver bumps work for small packages. For teams, set up changesets or semantic-release to automate version bumps based on commit messages.",
    detail: "Semver (MAJOR.MINOR.PATCH) is the contract between you and your consumers. Get it wrong and you'll break people's builds. Tools like changesets and semantic-release integrate with CI to automate the process.",
    jumpTo: "versioning"
  },
  {
    num: 12,
    title: "Test locally with " + cmd("npm link", "pnpm link"),
    desc: "Before publishing, test your package in a real project using " + cmd("npm link", "pnpm link") + ". This symlinks your local package into a test app so you can verify it works end-to-end.",
    detail: "Create a simple test app, run " + cmd("npm link ../your-package", "pnpm link ../your-package") + ", then try importing and using your package. Does it resolve? Do types work? Does tree-shaking work?",
    jumpTo: "workflow"
  },
  {
    num: 13,
    title: "Run the publish checklist & ship it",
    desc: "Go through the publish checklist, run " + cmd("npm pack --dry-run", "pnpm pack --dry-run") + " one final time, then " + cmd("npm publish", "pnpm publish") + ". Congratulations ‚Äî you're a package author!",
    detail: "After publishing, install your own package in a fresh project to verify everything works. Check that types resolve, imports work, and the bundle size is reasonable.",
    jumpTo: "checklist"
  }
];

function renderFootnotes(links, contentHtml) {
  if (!links || links.length === 0) return "";
  const footnoted = [];
  const furtherReading = [];
  links.forEach((link, i) => {
    const refPattern = `data-fn="${i + 1}"`;
    if (contentHtml && contentHtml.includes(refPattern)) {
      footnoted.push({ ...link, num: i + 1 });
    } else {
      furtherReading.push(link);
    }
  });

  let html = "";

  if (footnoted.length > 0) {
    html += `<div class="links-section">`;
    html += `<div class="links-heading">üìù Footnotes</div>`;
    html += `<div class="links-list">`;
    footnoted.forEach(link => {
      html += `<div class="footnote-item" id="fn-${link.num}">`;
      html += `<span class="footnote-num">${link.num}</span>`;
      html += `<span><a class="footnote-link" href="${link.url}" target="_blank" rel="noopener noreferrer">${link.label}</a>`;
      html += `<span class="footnote-source">${link.source}</span>`;
      if (link.note) html += `<span class="footnote-note">‚Äî ${link.note}</span>`;
      html += `</span></div>`;
    });
    html += `</div></div>`;
  }

  if (furtherReading.length > 0) {
    html += `<div class="links-section">`;
    html += `<div class="links-heading">üìö Further Reading</div>`;
    html += `<div class="links-list">`;
    furtherReading.forEach(link => {
      html += `<a class="link-chip" href="${link.url}" target="_blank" rel="noopener noreferrer">${link.label} <span class="link-source">${link.source}</span></a>`;
    });
    html += `</div></div>`;
  }

  return html;
}

function fnRef(n) { return `<sup class="fn-ref" data-fn="${n}" title="See footnote ${n}">${n}</sup>`; }

function renderPrevNext(currentId) {
  const order = getNavOrder();
  const idx = order.indexOf(currentId);
  let html = `<div class="section-nav">`;
  if (idx > 0) {
    const prevId = order[idx - 1];
    const prevTitle = getNavTitle(prevId);
    const prevText = prevTitle.replace(/^\S+\s+/, '');
    html += `<button class="section-nav-btn prev" data-nav="${prevId}"><span class="nav-arrow">‚Üê</span><span class="nav-label">${prevText}</span></button>`;
  }
  if (idx < order.length - 1) {
    const nextId = order[idx + 1];
    const nextTitle = getNavTitle(nextId);
    const nextText = nextTitle.replace(/^\S+\s+/, '');
    html += `<button class="section-nav-btn next" data-nav="${nextId}"><span class="nav-label">${nextText}</span><span class="nav-arrow">‚Üí</span></button>`;
  }
  html += `</div>`;
  return html;
}

function setupPrevNext(container) {
  container.querySelectorAll(".section-nav-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      activeSection = btn.dataset.nav;
      render();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  });
}

function render() {
  // Build sidebar nav with PM toggle
  const sidebarBody = document.getElementById("sidebar-body");

  const topItems = [
    { id: "roadmap", title: "üöÄ Start Here" },
    { id: "bigpicture", title: "üó∫Ô∏è Big Picture" }
  ];

  const conceptItems = [
    ...sections.filter(s => s.group === "concepts").map(s => ({ id: s.id, title: s.title }))
  ];

  const comparisonItems = [
    ...sections.filter(s => s.group !== "concepts" && s.id !== "bigpicture").map(s => ({ id: s.id, title: s.title }))
  ];

  const resourceItems = [
    { id: "checklist", title: "‚úÖ Publish Checklist" },
    { id: "overall-resources", title: "üìö Learning Resources" },
    { id: "section-links", title: "üîó Section References" }
  ];

  // Helper to render sidebar button with icon on right
  function sidebarBtn(item) {
    const match = item.title.match(/^(\S+)\s+(.+)$/);
    const icon = match ? match[1] : "";
    const text = match ? match[2] : item.title;
    const active = activeSection === item.id ? 'active' : '';
    return `<button class="sidebar-item ${active}" data-id="${item.id}"><span>${text}</span>${icon ? `<span class="sidebar-icon">${icon}</span>` : ''}</button>`;
  }

  let navHtml = "";

  topItems.forEach(item => { navHtml += sidebarBtn(item); });

  navHtml += `<div class="sidebar-group-label">Overall Concepts</div>`;
  conceptItems.forEach(item => { navHtml += sidebarBtn(item); });

  navHtml += `<div class="sidebar-group-label">Web App vs NPM Package</div>`;
  comparisonItems.forEach(item => { navHtml += sidebarBtn(item); });

  navHtml += `<div class="sidebar-group-label">CI Pipeline & Checks</div>`;
  ciPages.forEach(item => { navHtml += sidebarBtn(item); });

  navHtml += `<div class="sidebar-group-label">Bonus</div>`;
  bonusSections.forEach(item => { navHtml += sidebarBtn(item); });

  navHtml += `<div class="sidebar-group-label">Resources</div>`;
  resourceItems.forEach(item => { navHtml += sidebarBtn(item); });

  sidebarBody.innerHTML = navHtml;

  sidebarBody.querySelectorAll(".sidebar-item").forEach(btn => {
    btn.addEventListener("click", () => {
      activeSection = btn.dataset.id;
      closeSidebar();
      render();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  });

  // Update floating header
  const ciNavItems = ciPages.map(p => ({ id: p.id, title: p.title }));
  const bonusNavItems = bonusSections.map(s => ({ id: s.id, title: s.title }));
  const allItems = [...topItems, ...conceptItems, ...comparisonItems, ...ciNavItems, ...bonusNavItems, ...resourceItems];
  const current = allItems.find(i => i.id === activeSection);
  document.getElementById("header-section-name").textContent = current ? current.title : "";

  // Hide home button when already on Start Here
  document.getElementById("header-home-btn").style.display = activeSection === "roadmap" ? "none" : "flex";

  // Update PM switcher state
  document.getElementById("header-pm-label").textContent = currentPM;
  pmDropdown.querySelectorAll(".pm-dropdown-item[data-pm]").forEach(item => {
    const isActive = item.dataset.pm === currentPM;
    item.classList.toggle("active", isActive);
    item.querySelector(".pm-check").textContent = isActive ? "‚úì" : "";
  });
  setupPMDropdown();

  // Page header ‚Äî only on Start Here
  const pageHeaderEl = document.getElementById("page-header");
  if (activeSection === "roadmap") {
    pageHeaderEl.innerHTML = `<div class="page-header">
      <h1>Web App vs. NPM Package</h1>
      <p class="subtitle">A guide for backend engineers stepping into the frontend world.</p>
      <p class="hint">üí° Look for the green "Explain it to me" dropdowns for backend-friendly analogies.</p>
    </div>`;
  } else {
    pageHeaderEl.innerHTML = "";
  }

  // Content
  const contentEl = document.getElementById("content");

  if (activeSection === "roadmap") {
    renderRoadmap(contentEl);
    return;
  }

  if (activeSection === "checklist") {
    renderChecklist(contentEl);
    return;
  }

  if (activeSection === "overall-resources") {
    renderOverallResources(contentEl);
    return;
  }

  if (activeSection === "section-links") {
    renderSectionLinks(contentEl);
    return;
  }

  if (ciPageIds.includes(activeSection)) {
    renderCIPage(contentEl, activeSection);
    return;
  }

  if (bonusIds.includes(activeSection)) {
    renderBonusSection(contentEl, activeSection);
    return;
  }

  const s = sections.find(s => s.id === activeSection);
  if (!s) return;

  // Build TOC entries
  const tocEntries = [];
  if (s.customColumns) {
    tocEntries.push({ id: "toc-col1", label: s.col1Label.replace(/^\S+\s+/, '') });
    tocEntries.push({ id: "toc-col2", label: s.col2Label.replace(/^\S+\s+/, '') });
  } else if (s.webapp) {
    tocEntries.push({ id: "toc-webapp", label: "Web App" });
    tocEntries.push({ id: "toc-pkg", label: "NPM Package" });
  }
  if (s.explainerTitle) tocEntries.push({ id: "toc-explainer", label: s.explainerTitle });
  if (s.gotcha) tocEntries.push({ id: "toc-gotcha", label: "Watch out" });
  // Detect any section-subheading in intro
  if (s.intro) {
    const introHeadings = [...s.intro.matchAll(/id='(toc-[^']+)'[^>]*>([^<]+)</g)];
    if (introHeadings.length > 0) {
      introHeadings.forEach(m => tocEntries.unshift({ id: m[1], label: m[2] }));
    }
  }

  let html = `<h2 class="section-title">${s.title}</h2>`;

  // TOC if 3+ entries
  if (tocEntries.length >= 3) {
    html += `<div class="section-toc"><div class="section-toc-title">On this page</div>`;
    tocEntries.forEach(e => {
      html += `<a href="#${e.id}">${e.label}</a>`;
    });
    html += `</div>`;
  }

  if (s.intro) {
    html += `<div class="section-intro">${s.intro}</div>`;
  }

  if (s.customColumns) {
    html += `<h3 class="section-subheading" id="toc-col1">${s.col1Label}</h3>`;
    html += `<div class="section-list">${s.col1.map(p => `<div class="col-item">${p}</div>`).join("")}</div>`;
    html += `<h3 class="section-subheading" id="toc-col2">${s.col2Label}</h3>`;
    html += `<div class="section-list">${s.col2.map(p => `<div class="col-item">${p}</div>`).join("")}</div>`;
  } else if (s.webapp) {
    html += `<h3 class="section-subheading" id="toc-webapp">üåê Web App</h3>`;
    html += `<div class="section-list">${s.webapp.map(p => `<div class="col-item">${p}</div>`).join("")}</div>`;
    html += `<h3 class="section-subheading" id="toc-pkg">üì¶ NPM Package</h3>`;
    html += `<div class="section-list">${s.pkg.map(p => `<div class="col-item">${p}</div>`).join("")}</div>`;
  }

  if (s.explainerTitle) {
    html += `
      <div class="explainer">
        <h4 class="explainer-heading" id="toc-explainer">üí° ${s.explainerTitle}</h4>
        <div class="explainer-body">${s.explainerBody}</div>
      </div>`;
  }

  if (s.gotcha) {
    html += `<h4 class="section-subheading" id="toc-gotcha" style="margin-top: 24px;">‚ö†Ô∏è Watch out</h4>`;
    html += `<div class="gotcha">${s.gotcha}</div>`;
  }

  if (s.code) {
    html += `<div class="code-block">${codeExample}</div>`;
  }

  if (s.links && s.links.length > 0) {
    html += renderFootnotes(s.links, html);
  }

  html += renderPrevNext(activeSection);

  contentEl.innerHTML = html;

  contentEl.querySelectorAll(".inline-nav-link, .inline-nav-pill").forEach(btn => {
    btn.addEventListener("click", () => {
      activeSection = btn.dataset.nav;
      render();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  });

  setupPrevNext(contentEl);

  // Footnote ref scroll
  contentEl.querySelectorAll(".fn-ref").forEach(ref => {
    ref.style.cursor = "pointer";
    ref.addEventListener("click", () => {
      const fn = document.getElementById("fn-" + ref.dataset.fn);
      if (fn) fn.scrollIntoView({ behavior: 'smooth', block: 'center' });
    });
  });
}

function renderChecklist(el) {
  const checked = Object.values(checkedItems).filter(Boolean).length;
  const total = checklistItems.length;
  const pct = total > 0 ? (checked / total * 100) : 0;

  let html = `<h2 class="checklist-title">‚úÖ Publish Checklist</h2>`;
  html += `<p class="checklist-sub">Go through this before every ${cmd("npm publish", "pnpm publish")} ‚Äî trust us, it saves headaches.</p>`;
  html += `<button class="checklist-copy-btn" id="copy-checklist">üìã Copy as Markdown</button>`;

  checklistItems.forEach((item, i) => {
    const isChecked = checkedItems[i] || false;
    html += `
      <label class="check-item ${isChecked ? 'checked' : ''}" data-idx="${i}">
        <input type="checkbox" ${isChecked ? 'checked' : ''} data-idx="${i}">
        <span class="label">${item.text}</span>
        <span class="check-badge ${item.badge}">${item.cat}</span>
      </label>`;
  });

  html += `
    <div class="progress-row">
      <div class="progress-track"><div class="progress-fill" style="width: ${pct}%"></div></div>
      <span class="progress-label">${checked} / ${total}</span>
    </div>`;

  html += renderPrevNext("checklist");

  el.innerHTML = html;

  el.querySelectorAll("input[type='checkbox']").forEach(cb => {
    cb.addEventListener("change", () => {
      const idx = parseInt(cb.dataset.idx);
      checkedItems[idx] = cb.checked;
      renderChecklist(el);
    });
  });

  document.getElementById("copy-checklist").addEventListener("click", () => {
    const md = "# Publish Checklist\n\n" + checklistItems.map((item, i) => {
      const check = checkedItems[i] ? "x" : " ";
      const text = item.text.replace(/<[^>]*>/g, "").replace(/&amp;/g, "&").replace(/&lt;/g, "<").replace(/&gt;/g, ">");
      return `- [${check}] ${text} _(${item.cat})_`;
    }).join("\n");

    navigator.clipboard.writeText(md).then(() => {
      const btn = document.getElementById("copy-checklist");
      btn.textContent = "‚úì Copied!";
      btn.classList.add("copied");
      setTimeout(() => {
        btn.innerHTML = "üìã Copy as Markdown";
        btn.classList.remove("copied");
      }, 2000);
    });
  });

  setupPrevNext(el);
  el.querySelectorAll(".fn-ref").forEach(ref => { ref.style.cursor = "pointer"; ref.addEventListener("click", () => { const fn = document.getElementById("fn-" + ref.dataset.fn); if (fn) fn.scrollIntoView({ behavior: "smooth", block: "center" }); }); });
}

function renderCIPage(el, pageId) {
  const page = ciPages.find(p => p.id === pageId);
  if (!page) return;

  let html = `<h2 class="section-title">${page.title}</h2>`;

  if (page.isOverview) {
    html += `<div class="section-intro">${page.intro}</div>`;
    const subPages = ciPages.filter(p => !p.isOverview);
    html += `<div class="ci-overview-cards">`;
    subPages.forEach((sp, i) => {
      const yamlSnippet = sp.yaml || (sp.unitSection ? sp.unitSection.yaml : "") || (sp.tools ? sp.tools[0].yaml : "");
      html += `<div class="ci-overview-card">`;
      html += `<div class="ci-overview-num">${i + 1}</div>`;
      html += `<div class="ci-overview-card-body">`;
      html += `<div class="ci-overview-card-title">${sp.title}</div>`;
      if (yamlSnippet) html += `<div class="ci-yaml">${yamlSnippet}</div>`;
      html += `<button class="step-jump" data-nav="${sp.id}">‚Üí Learn more</button>`;
      html += `</div></div>`;
    });
    html += `</div>`;

    html += `<div class="ci-full-example">`;
    html += `<div class="ci-full-example-label">üìÑ Complete GitHub Actions workflow</div>`;
    html += `<div class="code-block">${page.exampleWorkflow}</div>`;
    html += `</div>`;

    html += `
      <div class="explainer">
        <h4 class="explainer-heading">üí° ${page.explainerTitle}</h4>
        <div class="explainer-body">${page.explainerBody}</div>
      </div>`;

  } else if (page.isTestingPage) {
    // TOC
    html += `<div class="section-toc"><div class="section-toc-title">On this page</div>`;
    html += `<a href="#toc-unit">Unit Tests</a>`;
    html += `<a href="#toc-e2e">E2E Tests</a>`;
    if (page.storybookNote) html += `<a href="#toc-component">Component Tests (Storybook)</a>`;
    html += `<a href="#toc-coverage">Test Coverage</a>`;
    html += `<a href="#toc-good-tests">What makes a good test?</a>`;
    html += `</div>`;

    html += `<div class="section-intro">${page.intro}</div>`;

    // Unit tests
    html += `<div class="ci-step">`;
    html += `<div class="ci-step-heading" id="toc-unit">${page.unitSection.heading}</div>`;
    html += `<div class="ci-step-text">${page.unitSection.text}</div>`;
    html += `<div class="yaml-heading">GitHub Actions Example</div>`;
    html += `<div class="ci-yaml">${page.unitSection.yaml}</div>`;
    html += `<div class="ci-tip">${page.unitSection.tip}</div>`;
    html += `</div>`;

    // E2E tests
    html += `<div class="ci-step">`;
    html += `<div class="ci-step-heading" id="toc-e2e">${page.e2eSection.heading}</div>`;
    html += `<div class="ci-step-text">${page.e2eSection.text}</div>`;
    html += `<div class="yaml-heading">GitHub Actions Example</div>`;
    html += `<div class="ci-yaml">${page.e2eSection.yaml}</div>`;
    html += `<div class="ci-tip">${page.e2eSection.tip}</div>`;
    html += `</div>`;

    // Storybook component tests note
    if (page.storybookNote) {
      html += `<div class="ci-step" id="toc-component"><div class="ci-step-heading">üìñ Component Tests (Storybook)</div><div class="ci-step-text">${page.storybookNote}</div></div>`;
    }

    html += `<div class="ci-step">`;
    html += `<div class="ci-step-heading" id="toc-coverage">üìä Test Coverage</div>`;
    html += `<div class="ci-step-text">${page.coverageText}</div>`;
    html += `</div>`;

    html += `<div class="ci-step">`;
    html += `<div class="ci-step-heading" id="toc-good-tests">‚úÖ What makes a good test?</div>`;
    html += `<div class="ci-step-text"><ul class="good-tests-list">`;
    page.goodTests.forEach(item => {
      html += `<li>${item}</li>`;
    });
    html += `</ul></div>`;
    html += `</div>`;

    // AI prompts accordion with copy buttons
    const aiOpen = expandedExplainers["ci-testing-ai"] || false;
    html += `
      <div class="accordion">
        <button class="accordion-toggle" data-explainer="ci-testing-ai">
          <span>ü§ñ Sample AI prompts for writing tests</span>
          <span class="accordion-arrow ${aiOpen ? 'open' : ''}">‚ñº</span>
        </button>
        <div class="accordion-body ${aiOpen ? 'open' : ''}">`;
    page.aiPrompts.forEach((p, i) => {
      html += `<div class="ai-prompt-card">`;
      html += `<div class="ai-prompt-header"><span class="ai-prompt-label">${p.label}</span><button class="ai-prompt-copy" data-prompt-idx="${i}">üìã Copy</button></div>`;
      html += `<div class="ai-prompt-body">${p.prompt}</div>`;
      html += `</div>`;
    });
    html += `</div></div>`;

  } else if (page.isMaintenancePage) {
    // TOC
    html += `<div class="section-toc"><div class="section-toc-title">On this page</div>`;
    page.tools.forEach(tool => {
      html += `<a href="#toc-${tool.name}">${tool.emoji} ${tool.name}</a>`;
    });
    html += `</div>`;

    html += `<div class="section-intro">${page.intro}</div>`;

    page.tools.forEach(tool => {
      html += `<div class="ci-step">`;
      html += `<div class="ci-step-heading" id="toc-${tool.name}">${tool.emoji} ${tool.name}</div>`;
      html += `<div class="ci-step-text">${tool.desc}</div>`;
      html += `<div class="ci-step-text"><strong>Why it matters:</strong> ${tool.why}</div>`;
      html += `<div class="yaml-heading">GitHub Actions Example</div>`;
      html += `<div class="ci-yaml">${tool.yaml}</div>`;
      html += `</div>`;
    });
    html += `<div class="ci-tip">${page.tip}</div>`;

  } else {
    // Standard sub-page: check if intro has section-subheading (linting page) for TOC
    const introHtml = page.intro;
    const headingMatches = [...introHtml.matchAll(/id='(toc-[^']+)'[^>]*>([^<]+)</g)];
    if (headingMatches.length > 1) {
      html += `<div class="section-toc"><div class="section-toc-title">On this page</div>`;
      headingMatches.forEach(m => {
        html += `<a href="#${m[1]}">${m[2]}</a>`;
      });
      html += `</div>`;
    }

    html += `<div class="section-intro">${page.intro}</div>`;
    html += `<div class="yaml-heading">GitHub Actions Example</div>`;
    html += `<div class="ci-yaml">${page.yaml}</div>`;
    html += `<div class="ci-tip">${page.tip}</div>`;
  }

  // Footnotes
  if (page.links && page.links.length > 0) {
    html += renderFootnotes(page.links, html);
  }

  html += renderPrevNext(pageId);

  el.innerHTML = html;

  el.querySelectorAll(".accordion-toggle").forEach(btn => {
    btn.addEventListener("click", () => {
      expandedExplainers[btn.dataset.explainer] = !expandedExplainers[btn.dataset.explainer];
      render();
    });
  });

  // Nav buttons in overview cards
  el.querySelectorAll(".step-jump[data-nav]").forEach(btn => {
    btn.addEventListener("click", () => {
      activeSection = btn.dataset.nav;
      render();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  });

  // AI prompt copy buttons
  if (page && page.aiPrompts) {
    el.querySelectorAll(".ai-prompt-copy").forEach(btn => {
      btn.addEventListener("click", () => {
        const idx = parseInt(btn.dataset.promptIdx);
        const prompt = page.aiPrompts[idx].prompt;
        navigator.clipboard.writeText(prompt).then(() => {
          btn.textContent = "‚úì Copied!";
          btn.classList.add("copied");
          setTimeout(() => {
            btn.textContent = "üìã Copy";
            btn.classList.remove("copied");
          }, 2000);
        });
      });
    });
  }

  // Inline navigation links
  el.querySelectorAll(".inline-nav-link, .inline-nav-pill").forEach(btn => {
    btn.addEventListener("click", () => {
      activeSection = btn.dataset.nav;
      render();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  });

  setupPrevNext(el);
  el.querySelectorAll(".fn-ref").forEach(ref => { ref.style.cursor = "pointer"; ref.addEventListener("click", () => { const fn = document.getElementById("fn-" + ref.dataset.fn); if (fn) fn.scrollIntoView({ behavior: "smooth", block: "center" }); }); });
}

function renderBonusSection(el, sectionId) {
  const section = bonusSections.find(s => s.id === sectionId);
  if (!section) return;

  let html = `<h2 class="section-title">${section.title}</h2>`;

  // Build TOC
  const tocEntries = [];
  if (section.content) {
    section.content.forEach((block, i) => {
      tocEntries.push({ id: "toc-bonus-" + i, label: block.heading });
    });
  }
  if (section.explainerTitle) tocEntries.push({ id: "toc-explainer", label: section.explainerTitle });

  if (tocEntries.length >= 3) {
    html += `<div class="section-toc"><div class="section-toc-title">On this page</div>`;
    tocEntries.forEach(e => { html += `<a href="#${e.id}">${e.label}</a>`; });
    html += `</div>`;
  }

  html += `<div class="section-intro">${section.intro}</div>`;

  if (section.content) {
    section.content.forEach((block, i) => {
      html += `<h4 class="section-subheading" id="toc-bonus-${i}">${block.heading}</h4>`;
      html += `<div class="ci-step-text">${block.text}</div>`;
    });
  }

  if (section.explainerTitle) {
    html += `
      <div class="explainer">
        <h4 class="explainer-heading" id="toc-explainer">üí° ${section.explainerTitle}</h4>
        <div class="explainer-body">${section.explainerBody}</div>
      </div>`;
  }

  if (section.links && section.links.length > 0) {
    html += renderFootnotes(section.links, html);
  }

  html += renderPrevNext(sectionId);
  el.innerHTML = html;

  setupPrevNext(el);
  el.querySelectorAll(".fn-ref").forEach(ref => { ref.style.cursor = "pointer"; ref.addEventListener("click", () => { const fn = document.getElementById("fn-" + ref.dataset.fn); if (fn) fn.scrollIntoView({ behavior: "smooth", block: "center" }); }); });
}

function renderRoadmap(el) {
  let html = `<h2 class="section-title">üöÄ Building a Package: Step by Step</h2>`;
  html += `<p class="roadmap-intro">New to npm packages? Follow these steps in order. Each step links to a deeper explanation in the other tabs. This is the order you'd actually set things up in a real project.</p>`;

  roadmapSteps.forEach(step => {
    html += `<div class="step-card ${step.jumpTo ? 'has-jump' : ''}">`;
    html += `<div class="step-number">${step.num}</div>`;
    html += `<div class="step-content">`;
    html += `<div class="step-title">${step.title}</div>`;
    html += `<div class="step-desc">${step.desc}</div>`;
    html += `<div class="step-detail">${step.detail}</div>`;
    if (step.jumpTo) {
      let label;
      if (step.jumpTo === "checklist") label = "‚úÖ Publish Checklist";
      else {
        const target = sections.find(s => s.id === step.jumpTo)
          || ciPages.find(p => p.id === step.jumpTo)
          || bonusSections.find(b => b.id === step.jumpTo);
        label = target ? target.title : step.jumpTo;
      }
      html += `<button class="step-jump" data-jump="${step.jumpTo}">‚Üí Deep dive: ${label}</button>`;
    }
    if (step.substep) {
      const subTarget = sections.find(s => s.id === step.substep.jumpTo)
        || ciPages.find(p => p.id === step.substep.jumpTo);
      const subLabel = subTarget ? subTarget.title : step.substep.jumpTo;
      html += `<div class="step-substep">`;
      html += `<div class="step-substep-text">‚Ü≥ ${step.substep.text}</div>`;
      html += `<button class="step-jump" data-jump="${step.substep.jumpTo}" style="margin-top: 4px;">‚Üí Deep dive: ${subLabel}</button>`;
      html += `</div>`;
    }
    html += `</div></div>`;
  });

  // Bonus cards ‚Äî each gets its own card
  // CI Pipeline
  html += `<div class="step-card bonus-step">`;
  html += `<div class="step-number bonus-number">‚òÖ</div>`;
  html += `<div class="step-content">`;
  html += `<div class="step-title">Bonus: CI Pipeline & Checks</div>`;
  html += `<div class="step-desc">Automate linting, build verification, and testing so they run on every push and pull request. A single YAML file can catch bugs before they're ever merged.</div>`;
  ciPages.forEach(cp => {
    html += `<button class="step-jump" data-jump="${cp.id}">‚Üí ${cp.title}</button>`;
  });
  html += `</div></div>`;

  // Storybook
  bonusSections.forEach(bs => {
    html += `<div class="step-card bonus-step">`;
    html += `<div class="step-number bonus-number">‚òÖ</div>`;
    html += `<div class="step-content">`;
    html += `<div class="step-title">Bonus: ${bs.title.replace(/^\S+\s+/, '')}</div>`;
    html += `<div class="step-desc">${bs.intro.substring(0, 200).replace(/<[^>]*>/g, '')}‚Ä¶</div>`;
    html += `<button class="step-jump" data-jump="${bs.id}">‚Üí Deep dive: ${bs.title}</button>`;
    html += `</div></div>`;
  });

  html += renderPrevNext("roadmap");

  el.innerHTML = html;

  el.querySelectorAll(".step-jump").forEach(btn => {
    btn.addEventListener("click", () => {
      activeSection = btn.dataset.jump;
      render();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  });

  setupPrevNext(el);
  el.querySelectorAll(".fn-ref").forEach(ref => { ref.style.cursor = "pointer"; ref.addEventListener("click", () => { const fn = document.getElementById("fn-" + ref.dataset.fn); if (fn) fn.scrollIntoView({ behavior: "smooth", block: "center" }); }); });
}

const overallResources = [
  {
    category: "üìñ Official Documentation",
    items: [
      { name: "npm Docs ‚Äî Getting Started", url: "https://docs.npmjs.com/getting-started", desc: "Official npm guide from account setup to publishing", badges: ["docs", "free"] },
      { name: "pnpm Documentation", url: "https://pnpm.io/motivation", desc: "Official pnpm docs ‚Äî why pnpm and how to use it", badges: ["docs", "free"] },
      { name: "Node.js ‚Äî Packages Documentation", url: "https://nodejs.org/api/packages.html", desc: "How Node.js resolves modules, exports maps, and package entry points", badges: ["docs", "free"] },
      { name: "MDN ‚Äî JavaScript Modules", url: "https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules", desc: "Comprehensive guide to ESM import/export syntax and how modules work", badges: ["docs", "free"] },
      { name: "TypeScript ‚Äî Publishing Declaration Files", url: "https://www.typescriptlang.org/docs/handbook/declaration-files/publishing.html", desc: "How to ship .d.ts type declarations with your package", badges: ["docs", "free"] },
      { name: "Semantic Versioning Specification", url: "https://semver.org/", desc: "The official semver spec ‚Äî the versioning contract every package follows", badges: ["docs", "free"] },
    ]
  },
  {
    category: "üìù Articles & Tutorials",
    items: [
      { name: "Best Practices for Creating a Modern npm Package (Snyk)", url: "https://snyk.io/blog/best-practices-create-modern-npm-package/", desc: "End-to-end walkthrough: TypeScript, CI/CD, security, semantic-release", badges: ["article", "free"] },
      { name: "Building and Publishing TypeScript NPM Packages", url: "https://akashrajpurohit.com/blog/building-and-publishing-typescript-npm-packages-a-stepbystep-guide/", desc: "Step-by-step with tsup, vitest, and semantic-release", badges: ["article", "free"] },
      { name: "How to Create an NPM Package in TypeScript (Atomic Object)", url: "https://spin.atomicobject.com/npm-package-typescript/", desc: "From absolute minimum to complete importable module ‚Äî ground up approach", badges: ["article", "free"] },
      { name: "Conventional Commits", url: "https://www.conventionalcommits.org/", desc: "The commit message standard that powers automated versioning", badges: ["docs", "free"] },
    ]
  },
  {
    category: "üéì Free Courses & Interactive Learning",
    items: [
      { name: "Publish JavaScript Packages on npm (egghead.io)", url: "https://egghead.io/courses/publish-javascript-packages-on-npm", desc: "Free community course ‚Äî create, test, publish, and update a package", badges: ["course", "free", "video"] },
      { name: "How to Write an Open Source JavaScript Library (egghead.io)", url: "https://egghead.io/courses/how-to-write-an-open-source-javascript-library", desc: "Covers GitHub setup, npm publishing, semantic-release, and CI automation", badges: ["course", "free", "video"] },
      { name: "NodeSchool Workshops", url: "https://nodeschool.io/", desc: "Interactive terminal-based tutorials for Node.js, npm, and JS fundamentals", badges: ["interactive", "free"] },
      { name: "Learn NPM ‚Äî codedamn", url: "https://codedamn.com/learn/npm-basics", desc: "Interactive browser-based course with built-in coding exercises", badges: ["interactive", "free"] },
    ]
  },
  {
    category: "üí∞ Paid Courses",
    items: [
      { name: "Creating NPM Packages: The Complete Guide (Udemy)", url: "https://www.udemy.com/course/creating-npm-packages-the-complete-guide/", desc: "Highest rated (4.9‚òÖ) ‚Äî tree-shaking, CI automation, pre-release versions, TypeScript", badges: ["course", "paid", "video"] },
      { name: "NPM Mastery: Package Management & Publishing (Udemy)", url: "https://www.udemy.com/course/npm-mastery-nodejs-package-management-publishing/", desc: "Comprehensive bootcamp from basics to publishing with a capstone CLI project", badges: ["course", "paid", "video"] },
      { name: "Understanding NPM (Udemy)", url: "https://www.udemy.com/course/understanding-npm/", desc: "Deep dive into npm internals ‚Äî scripts, bins, semver, lock files", badges: ["course", "paid", "video"] },
    ]
  },
  {
    category: "üõ† Starter Templates & Tools",
    items: [
      { name: "npm Package Boilerplate 2025", url: "https://github.com/simonorzel26/npm-package-boilerplate-2025", desc: "Opinionated starter with pnpm, TypeScript, ESM+CJS, and automated releases", badges: ["repo", "free"] },
      { name: "tsup ‚Äî Bundle TypeScript Libraries", url: "https://tsup.egoist.dev/", desc: "The easiest way to build TypeScript packages ‚Äî zero config ESM/CJS output", badges: ["docs", "free"] },
      { name: "changesets ‚Äî Version Management", url: "https://github.com/changesets/changesets", desc: "Manage versioning and changelogs for packages, especially in monorepos", badges: ["repo", "free"] },
      { name: "semantic-release", url: "https://semantic-release.gitbook.io/semantic-release", desc: "Fully automated versioning and publishing based on commit messages", badges: ["docs", "free"] },
    ]
  },
  {
    category: "üèóÔ∏è Monorepo Tools & Resources",
    items: [
      { name: "Turborepo ‚Äî Getting Started", url: "https://turbo.build/repo/docs", desc: "High-performance build system for JS/TS monorepos ‚Äî smart caching and parallel builds", badges: ["docs", "free"] },
      { name: "Nx ‚Äî Getting Started", url: "https://nx.dev/getting-started/intro", desc: "Full-featured monorepo tool with dependency graph, affected commands, and code generation", badges: ["docs", "free"] },
      { name: "Lerna ‚Äî Modern Monorepo Management", url: "https://lerna.js.org/", desc: "The original JS monorepo tool ‚Äî now maintained by Nx, great for coordinating package publishes", badges: ["docs", "free"] },
      { name: "npm Workspaces docs", url: "https://docs.npmjs.com/cli/v10/using-npm/workspaces", desc: "Built-in npm feature for linking local packages together in a monorepo", badges: ["docs", "free"] },
      { name: "pnpm Workspaces docs", url: "https://pnpm.io/workspaces", desc: "pnpm's workspace feature ‚Äî fast, strict, and great for monorepos", badges: ["docs", "free"] },
    ]
  }
];

const badgeMap = {
  free: { cls: "rb-free", label: "Free" },
  paid: { cls: "rb-paid", label: "Paid" },
  docs: { cls: "rb-docs", label: "Docs" },
  article: { cls: "rb-article", label: "Article" },
  course: { cls: "rb-course", label: "Course" },
  video: { cls: "rb-video", label: "Video" },
  repo: { cls: "rb-repo", label: "Repo" },
  interactive: { cls: "rb-interactive", label: "Interactive" }
};

function renderResourcesTable(groups) {
  let html = "";
  groups.forEach(group => {
    html += `<div class="resources-category">${group.category}</div>`;
    group.items.forEach(item => {
      html += `<div class="resource-row">`;
      html += `<a class="resource-link" href="${item.url}" target="_blank" rel="noopener noreferrer">${item.name}</a>`;
      html += `<span class="resource-desc">${item.desc}</span>`;
      html += `<span class="resource-badges">`;
      item.badges.forEach(b => {
        const badge = badgeMap[b];
        if (badge) html += `<span class="resource-badge ${badge.cls}">${badge.label}</span>`;
      });
      html += `</span></div>`;
    });
  });
  return html;
}

function renderOverallResources(el) {
  let html = `<h2 class="section-title">üìö Learning Resources</h2>`;
  html += `<p style="color: var(--muted); font-size: 14px; margin-bottom: 24px; line-height: 1.6;">Documentation, articles, courses, and tools to go deeper. Free resources are marked ‚Äî paid courses often go on sale on Udemy for under $15.</p>`;
  html += `<div class="resources-section">`;
  html += renderResourcesTable(overallResources);
  html += `</div>`;
  html += renderPrevNext("overall-resources");
  el.innerHTML = html;
  setupPrevNext(el);
  el.querySelectorAll(".fn-ref").forEach(ref => { ref.style.cursor = "pointer"; ref.addEventListener("click", () => { const fn = document.getElementById("fn-" + ref.dataset.fn); if (fn) fn.scrollIntoView({ behavior: "smooth", block: "center" }); }); });
}

function renderSectionLinks(el) {
  let html = `<h2 class="section-title">üîó Section References</h2>`;
  html += `<p style="color: var(--muted); font-size: 14px; margin-bottom: 24px; line-height: 1.6;">All the "Read More" links from the deep-dive sections, collected in one place for quick reference.</p>`;
  html += `<div class="resources-section">`;

  // Collect all links from sections, deduped by URL
  const seen = new Set();
  const overallUrls = new Set();
  overallResources.forEach(g => g.items.forEach(i => overallUrls.add(i.url)));

  const groups = [];
  // Also include CI section and bonus section links
  const allSectionsWithLinks = [...sections, ...ciPages, ...bonusSections];
  allSectionsWithLinks.forEach(s => {
    if (s.links && s.links.length > 0) {
      const uniqueLinks = s.links.filter(l => {
        if (seen.has(l.url) || overallUrls.has(l.url)) return false;
        seen.add(l.url);
        return true;
      });
      if (uniqueLinks.length > 0) {
        groups.push({
          category: s.title,
          items: uniqueLinks.map(l => ({
            name: l.label,
            url: l.url,
            desc: "",
            badges: ["docs"]
          }))
        });
      }
    }
  });

  html += renderResourcesTable(groups);
  html += `</div>`;
  html += renderPrevNext("section-links");
  el.innerHTML = html;
  setupPrevNext(el);
  el.querySelectorAll(".fn-ref").forEach(ref => { ref.style.cursor = "pointer"; ref.addEventListener("click", () => { const fn = document.getElementById("fn-" + ref.dataset.fn); if (fn) fn.scrollIntoView({ behavior: "smooth", block: "center" }); }); });
}

render();
</script>
</body>
</html>
